<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place Order - 11am Coffee</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    </script>
    <link rel="stylesheet" href="modal\modelstyle.css">
    <link rel="stylesheet" href="common.css">
    <!-- Favicon -->
    <link rel="icon" href="images/11amV2.png" type="image/x-icon">
    <link rel="shortcut icon" href="images/11amV2.png" type="image/x-icon">
    <!-- Optional for better support -->
    <link rel="apple-touch-icon" sizes="180x180" href="images/11amV2.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/11amV2.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/11amV2.png">
    <style>
      /* Order Page Specific Styles */
      .order-section {
        padding: 60px 0;
        background-color: #fff;
      }

      .order-container {
        max-width: 800px;
        margin: 0 auto;
        background: #fff;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .section-title {
        font-size: 36px;
        margin-bottom: 20px;
        position: relative;
        display: inline-block;
        color: #3b2a21;
      }

      .section-title::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 60px;
        height: 3px;
        background: #d9a66d;
      }

      .order-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        position: relative;
      }

      .order-steps::before {
        content: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        background: #e0e0e0;
        z-index: 1;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
      }

      .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e0e0e0;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-bottom: 10px;
        transition: all 0.3s ease;
      }

      .step.active .step-number {
        background: #5d4037;
      }

      .step-label {
        font-size: 14px;
        color: #888;
        transition: all 0.3s ease;
      }

      .step.active .step-label {
        color: #5d4037;
        font-weight: bold;
      }

      /* Product Selection */
      .product-selection {
        margin-bottom: 40px;
      }

      .product-item {
        display: flex;
        align-items: center;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
      }

      .product-item:hover {
        border-color: #d9a66d;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .product-image {
        width: 100px;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        margin-right: 20px;
      }

      .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .product-details {
        flex: 1;
      }

      .product-name {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #3b2a21;
      }

      .product-description {
        color: #7a5c44;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .product-price {
        font-size: 18px;
        font-weight: 700;
        color: #5d4037;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .quantity-btn {
        width: 30px;
        height: 30px;
        border: 1px solid #ddd;
        background: #f9f9f9;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quantity-btn:hover {
        background: #e9e9e9;
      }

      .quantity-input {
        width: 50px;
        text-align: center;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        font-size: 16px;
      }

      /* Delivery Section */
      .delivery-section {
        margin-bottom: 40px;
      }

      .delivery-options {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .delivery-option {
        flex: 1;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .delivery-option.active {
        border-color: #5d4037;
        background: #f9f5f0;
      }

      .delivery-option i {
        font-size: 24px;
        margin-bottom: 10px;
        color: #7a5c44;
      }

      .delivery-option.active i {
        color: #5d4037;
      }

      .postcode-check {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .postcode-input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
      }

      .check-btn {
        padding: 12px 20px;
        background: #5d4037;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .check-btn:hover {
        background: #8d6e63;
      }

      .delivery-result {
        margin-top: 15px;
        padding: 10px;
        border-radius: 8px;
        display: none;
      }

      .delivery-result.available {
        background: #e8f5e8;
        color: #2e7d32;
        display: block;
      }

      .delivery-result.unavailable {
        background: #ffebee;
        color: #c62828;
        display: block;
      }

      /* Customer Details */
      .customer-details {
        margin-bottom: 40px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #3b2a21;
      }

      .form-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .form-input:focus {
        border-color: #5d4037;
        outline: none;
        box-shadow: 0 0 0 2px rgba(93, 64, 55, 0.2);
      }

      .form-row {
        display: flex;
        gap: 20px;
      }

      .form-row .form-group {
        flex: 1;
      }

      /* Order Summary */
      .order-summary {
        background: #f9f5f0;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
      }

      .summary-total {
        display: flex;
        justify-content: space-between;
        font-weight: 700;
        font-size: 18px;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 2px solid #d9a66d;
      }

      /* Buttons */
      .btn-group {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
      }

      .btn {
        padding: 12px 30px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 16px;
      }

      .btn-primary {
        background: #5d4037;
        color: #fff;
      }

      .btn-primary:hover {
        background: #8d6e63;
      }

      .btn-secondary {
        background: #e0e0e0;
        color: #333;
      }

      .btn-secondary:hover {
        background: #d0d0d0;
      }

      /* Footer */
      .footer {
        background: #3b2a21;
        color: #e1dfdc;
        padding: 60px 20px 30px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      .footer .footer-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 40px;
        max-width: 1100px;
        margin: 0 auto 40px;
      }

      .footer-column h3 {
        font-size: 20px;
        color: #f8f6f3;
        margin-bottom: 15px;
        position: relative;
      }

      .footer-column h3::after {
        content: "";
        width: 40px;
        height: 2px;
        background: #c89b6d;
        position: absolute;
        bottom: -6px;
        left: 0;
      }

      .footer-column p,
      .footer-column ul {
        font-size: 15px;
        line-height: 1.7;
        margin: 0;
      }

      .footer-column ul {
        list-style: none;
        padding: 0;
      }

      .footer-column ul li {
        margin-bottom: 10px;
      }

      .footer-column a {
        color: #e1dfdc;
        text-decoration: none;
        transition: color 0.3s;
      }

      .footer-column a:hover {
        color: #c89b6d;
      }

      .social-icons a {
        font-size: 20px;
        margin-right: 12px;
        color: #e1dfdc;
        transition: color 0.3s;
      }

      .social-icons a:hover {
        color: #c89b6d;
      }

      .copyright {
        text-align: center;
        font-size: 14px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 20px;
        color: #aaa;
      }

      /* Date & Time Picker Styles */
      .date-picker-trigger,
      .time-picker-trigger {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        color: #3b2a21;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        margin-bottom: 10px;
      }

      .date-picker-trigger:hover,
      .time-picker-trigger:hover {
        border-color: #d9a66d;
      }

      .date-picker-trigger:focus,
      .time-picker-trigger:focus {
        border-color: #5d4037;
        outline: none;
        box-shadow: 0 0 0 2px rgba(93, 64, 55, 0.1);
      }

      /* Time Picker Styles */
      .time-slots-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 10px;
      }

      .time-slot {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: 600;
        color: #3b2a21;
      }

      .time-slot:hover {
        border-color: #d9a66d;
        transform: translateY(-1px);
      }

      .time-slot.selected {
        background: #5d4037;
        color: white;
        border-color: #5d4037;
      }

      .time-group-title {
        font-size: 14px;
        font-weight: 600;
        color: #7a5c44;
        margin: 15px 0 8px 0;
      }

      /* Modal Styles for Date/Time Picker */
      .modal-overlay-datetime {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .modal-overlay-datetime.active {
        visibility: visible;
        opacity: 1;
      }

      .modal-content {
        width: 100%;
        max-width: 400px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-30px) scale(0.9);
        }

        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* Date Picker Modal */
      .datepicker-header {
        background: linear-gradient(135deg, #5d4037 0%, #8d6e63 100%);
        color: white;
        padding: 20px;
        text-align: center;
      }

      .datepicker-month-year {
        font-size: 18px;
        font-weight: 700;
        margin: 0;
        font-family: 'Playfair Display', serif;
      }

      .datepicker-days-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: #7a5c44;
        color: white;
        font-weight: 600;
        font-size: 12px;
        text-align: center;
        padding: 10px 0;
        text-transform: uppercase;
      }

      .datepicker-days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #f0f0f0;
        padding: 1px;
        min-height: 250px;
      }

      .datepicker-day {
        background: white;
        border: none;
        padding: 12px 0;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        color: #333;
      }

      .datepicker-day:hover {
        background: #f8f8f8;
      }

      .datepicker-day.selected {
        background: #5d4037;
        color: white;
      }

      .datepicker-day.disabled {
        color: #ccc;
        cursor: not-allowed;
        background: #fafafa;
      }

      .datepicker-day.other-month {
        color: #ddd;
        background: #fafafa;
      }

      .datepicker-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #f9f5f0;
        border-top: 1px solid #e8e8e8;
      }

      .nav-btn {
        background: #5d4037;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .nav-btn:hover {
        background: #8d6e63;
      }

      .modal-footer {
        padding: 20px;
        background: white;
        border-top: 1px solid #e8e8e8;
      }

      .selected-display {
        text-align: center;
        font-size: 14px;
        color: #666;
        margin-bottom: 15px;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 6px;
        font-weight: 500;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn {
        flex: 1;
        padding: 15px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: #5d4037;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #8d6e63;
      }

      .btn-primary:disabled {
        background: #bdbdbd;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: #e0e0e0;
        color: #333;
      }

      .btn-secondary:hover {
        background: #d0d0d0;
      }

      /* FIXED: Small centered modal on mobile - NO SCROLLBAR */
      @media (max-width: 768px) {
        .modal-overlay-datetime {
          padding: 20px !important;
          align-items: center !important;
          background: rgba(0, 0, 0, 0.8) !important;
        }

        .modal-overlay-datetime .modal-content {
          width: 95% !important;
          max-width: 360px !important;
          margin: 0 auto !important;
          max-height: 800px !important;
          height: auto !important;
          border-radius: 12px !important;
          overflow-y: auto !important;
        }

        .modal-overlay-datetime .calendar-container {
          padding: 10px 8px 5px 8px !important;
        }

        .modal-overlay-datetime .calendar-header {
          font-size: 16px !important;
          margin-bottom: 8px !important;
          padding: 5px !important;
        }

        .modal-overlay-datetime .calendar-grid-header {
          font-size: 10px !important;
          padding: 6px 0 !important;
          margin-bottom: 3px !important;
        }

        .modal-overlay-datetime .calendar-grid {
          gap: 2px !important;
          padding: 0 !important;
          min-height: 180px !important;
        }

        .modal-overlay-datetime .calendar-day {
          width: 32px !important;
          height: 32px !important;
          font-size: 12px !important;
          padding: 0 !important;
          margin: 0 !important;
          min-width: unset !important;
        }

        .modal-overlay-datetime .calendar-nav {
          padding: 8px 5px !important;
          gap: 6px !important;
          margin-top: 8px !important;
        }

        .modal-overlay-datetime .nav-button {
          padding: 6px 8px !important;
          font-size: 11px !important;
          flex: 1 !important;
        }

        .modal-overlay-datetime #selectedDateDisplay {
          font-size: 12px !important;
          padding: 8px !important;
          margin: 5px 0 !important;
          line-height: 1.3 !important;
          min-height: auto !important;
        }

        .modal-overlay-datetime .time-picker-section {
          margin: 8px !important;
          padding: 8px !important;
        }

        .modal-overlay-datetime .section-title {
          font-size: 14px !important;
          margin-bottom: 6px !important;
        }

        .modal-overlay-datetime .time-group-title {
          font-size: 12px !important;
          margin-bottom: 6px !important;
          padding: 6px !important;
        }

        .modal-overlay-datetime .time-slots-grid {
          gap: 5px !important;
          margin-top: 5px !important;
        }

        .modal-overlay-datetime .time-slot {
          padding: 6px 4px !important;
          font-size: 11px !important;
          margin: 0 !important;
          min-height: 32px !important;
          line-height: 1.2 !important;
        }

        .modal-overlay-datetime .modal-actions {
          padding: 10px 8px !important;
          gap: 6px !important;
        }

        .modal-overlay-datetime .action-button {
          padding: 8px 6px !important;
          font-size: 12px !important;
          flex: 1 !important;
          min-height: auto !important;
        }
      }

      /* iPhone SE and very small devices */
      @media (max-width: 375px) {
        .modal-overlay-datetime .modal-content {
          max-width: 340px !important;
          max-height: 500px !important;
        }

        .modal-overlay-datetime .calendar-day {
          width: 30px !important;
          height: 30px !important;
          font-size: 11px !important;
        }

        .modal-overlay-datetime .time-slot {
          padding: 5px 3px !important;
          font-size: 10px !important;
          min-height: 30px !important;
        }

        .modal-overlay-datetime .calendar-header {
          font-size: 15px !important;
        }

        .modal-overlay-datetime .calendar-grid {
          min-height: 170px !important;
        }
      }

      /* Ensure no scroll on body when modal is open */
      body.modal-open {
        overflow: hidden !important;
      }

      /* Tablet adjustments */
      @media (min-width: 769px) and (max-width: 1024px) {
        .modal-overlay-datetime .modal-content {
          max-width: 450px !important;
        }

        .modal-overlay-datetime .calendar-day {
          width: 38px !important;
          height: 38px !important;
        }
      }

      /* Mobile Responsive for Date/Time Picker */
      @media (max-width: 480px) {
        .time-slots-grid {
          grid-template-columns: 1fr;
        }

        .datepicker-days-grid {
          min-height: 200px;
        }

        .datepicker-day {
          padding: 10px 0;
        }
      }

      /* Responsive Design for main page */
      @media (max-width: 768px) {
        .mobile-menu-btn {
          display: flex;
        }

        .nav-menu {
          display: none;
          position: absolute;
          top: 70px;
          left: 0;
          width: 100%;
          background: white;
          flex-direction: column;
          padding: 20px;
          box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
          gap: 20px;
        }

        .nav-menu.active {
          display: flex;
        }

        .logo {
          position: absolute;
          font-size: 24px;
          text-align: left;
          padding-left: 10px;
        }

        .order-steps {
          flex-direction: row;
          justify-content: space-between;
          margin-bottom: 30px;
          padding: 0 10px;
        }

        .order-steps::before {
          display: block;
          top: 20px;
        }

        .step {
          flex-direction: column;
          gap: 8px;
          text-align: center;
        }

        .step-number {
          width: 36px;
          height: 36px;
          font-size: 14px;
        }

        .step-label {
          font-size: 11px;
          text-align: center;
          line-height: 1.2;
        }

        .product-item {
          flex-direction: column;
          text-align: center;
        }

        .product-image {
          margin-right: 0;
          margin-bottom: 15px;
          width: 200px;
          height: 200px;
        }

        .delivery-options {
          flex-direction: column;
        }

        .form-row {
          flex-direction: column;
          gap: 0;
        }

        .btn-group {
          flex-direction: column;
        }
      }

      /* Print Template (hidden on screen) */
      #printTemplate {
        display: none;
      }

      /* Print-specific styles */
      @media print {

        body,
        html {
          width: 100%;
          height: auto;
          margin: 0;
          padding: 0;
          background: white !important;
        }

        /* Hide everything except the print template */
        body * {
          display: none !important;
        }

        #printTemplate,
        #printTemplate * {
          display: block !important;
          visibility: visible !important;
        }

        #printTemplate {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          height: auto;
          margin: 0;
          padding: 20px;
          background: white;
          font-size: 18px;
        }

        .print-container {
          max-width: 400px;
          margin: 0 auto;
          text-align: center;
        }

        .print-header {
          margin-bottom: 25px;
          padding-bottom: 15px;
          border-bottom: 2px solid #eee;
        }

        .print-title {
          font-size: 24px;
          color: #2c3e50;
          margin-bottom: 10px;
        }

        .print-detail {
          margin: 20px 0;
          padding: 15px;
          background: #f9f9f9;
          border-radius: 8px;
        }

        .print-label {
          font-weight: bold;
          color: #7f8c8d;
          margin-bottom: 5px;
        }

        .print-value {
          font-size: 20px;
          color: #2c3e50;
        }

        .print-orderid {
          font-size: 26px;
          font-weight: bold;
          color: #e74c3c;
          letter-spacing: 2px;
        }

        .print-footer {
          margin-top: 30px;
          padding-top: 15px;
          border-top: 2px solid #eee;
          color: #7f8c8d;
          font-size: 16px;
        }
    </style>
  </head>
  <body>
    <!-- Announcement Bar -->
    <div class="announcement-bar">
      <i class="fas fa-bullhorn"></i>
      <span class="announcement-full"></span>
      <span class="announcement-short"> &nbsp; Pre-orders now open. Exclusive delivery within KL. Enjoy complimentary delivery with purchases of 3 bundles/18 pouches or more. &nbsp; </span>
    </div>
    <!-- Header -->
    <header>
      <div class="header-container">
        <!-- Mobile menu button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i class="fas fa-bars"></i>
        </button>
        <!-- Center: Logo -->
        <div class="logo" style="left: 50%; transform: translateX(-50%); display: flex;">
          <a href="index.html" style="text-decoration: none; display: flex; align-items: center;">
            <img src="images/logo/ig profile.png" alt="11am Coffee Logo" style="height: 40px; width: auto; transform: scale(2); transform-origin: center;">
          </a>
        </div>
        <!-- Mobile Actions (only show on mobile) -->
        <div class="mobile-actions">
          <button class="icon-btn" id="orderCheckBtnOpen">
            <img src="images/track3.png" alt="Order Check" class="icon-img">
          </button>
          <button class="icon-btn" id="deliveryCheckBtn">
            <img src="images/loca1.png" alt="Order Check" class="icon-img">
          </button>
        </div>
        <!-- Navigation Menu -->
        <nav class="nav-menu" id="navMenu">
          <a href="index.html" class="nav-link">Home</a>
          <a href="index.html#shop" class="nav-link">Shop</a>
          <a href="order.html" class="nav-link">Order</a>
          <a href="index.html#feedback-form" class="nav-link">Feedback</a>
          <a href="index.html#about" class="nav-link">About Us</a>
        </nav>
        <!-- Right: Icons -->
        <div class="nav-icons" style="display: flex; align-items: center; gap: 12px;">
          <button class="icon-btn" id="orderCheckBtnOpenNav" style="background: none; border: none; cursor: pointer;">
            <img src="images/track3.png" alt="Order Check" class="icon-img">
          </button>
          <button class="icon-btn" id="deliveryCheckBtnNav" style="background: none; border: none; cursor: pointer;">
            <img src="images/loca1.png" alt="Delivery Check" class="icon-img">
          </button>
        </div>
      </div>
    </header>
    <!-- Order Section -->
    <section class="order-section">
      <div class="container">
        <div class="order-container">
          <h2 class="section-title">Place Your Order</h2>
          <!-- Order Steps -->
          <div class="order-steps">
            <div class="step active">
              <div class="step-number">1</div>
              <div class="step-label">Select Products</div>
            </div>
            <div class="step">
              <div class="step-number">2</div>
              <div class="step-label">Delivery Info</div>
            </div>
            <div class="step">
              <div class="step-number">3</div>
              <div class="step-label">Customer Details</div>
            </div>
            <div class="step">
              <div class="step-number">4</div>
              <div class="step-label">Review & Pay</div>
            </div>
          </div>
          <!-- Product Selection -->
          <div class="product-selection">
            <h3>Select Your Coffee</h3>
            <div class="product-item">
              <div class="product-image">
                <img src="productionImage\order\order-photo-01.jpg" alt="Single Brew">
              </div>
              <div class="product-details">
                <div class="product-name">Single Brew</div>
                <div class="product-description">
                  <p>6 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts </p>
                </div>
                <div class="product-price">RM 36</div>
              </div>
              <div class="quantity-controls">
                <button class="quantity-btn minus" data-product="singlebrew">-</button>
                <input type="number" class="quantity-input" id="singlebrew-qty" value="0" min="0" max="10">
                <button class="quantity-btn plus" data-product="singlebrew">+</button>
              </div>
            </div>
            <div class="product-item">
              <div class="product-image">
                <img src="productionImage\order\order-photo-02.jpg" alt="Couple Brew">
              </div>
              <div class="product-details">
                <div class="product-name">Couple Brew</div>
                <div class="product-description">12 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts </div>
                <div class="product-price">RM 70</div>
              </div>
              <div class="quantity-controls">
                <button class="quantity-btn minus" data-product="couplebrew">-</button>
                <input type="number" class="quantity-input" id="couplebrew-qty" value="0" min="0" max="10">
                <button class="quantity-btn plus" data-product="couplebrew">+</button>
              </div>
            </div>
            <div class="product-item">
              <div class="product-image">
                <img src="productionImage\order\order-photo-03.jpg" alt="Family Brew">
              </div>
              <div class="product-details">
                <div class="product-name">Family Brew</div>
                <div class="product-description">18 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts </div>
                <div class="product-price">RM 105</div>
              </div>
              <div class="quantity-controls">
                <button class="quantity-btn minus" data-product="familybrew">-</button>
                <input type="number" class="quantity-input" id="familybrew-qty" value="0" min="0" max="10">
                <button class="quantity-btn plus" data-product="familybrew">+</button>
              </div>
            </div>
          </div>
          <!-- Delivery Section -->
          <div class="delivery-section">
            <h3>Delivery Information</h3>
            <div class="delivery-options">
              <div class="delivery-option active" id="delivery-option">
                <i class="fas fa-truck"></i>
                <div>Delivery</div>
              </div>
              <div class="delivery-option" id="pickup-option">
                <i class="fas fa-store"></i>
                <div>Pickup</div>
              </div>
            </div>
            <div id="delivery-details">
              <label class="form-label" for="name">Check delivery availability:</label>
              <div class="postcode-check">
                <input type="text" class="postcode-input" id="postcodeorder" placeholder="Postcode" maxlength="5" readonly>
                <button class="check-btn" id="checkPostcode">Check</button>
              </div>
              <div class="delivery-result" id="delivery-result"></div>
              <!-- Delivery DateTime -->
              <div class="form-group" style='padding-top:10px;'>
                <label class="form-label" for="name">Delivery Date & Time</label>
                <input type="text" id="delivery-datetime" class="form-input" placeholder="Click to select delivery date & time" required style="cursor: pointer;">
                <p style="color: #b08d57;">Preorder at least 3 days in advance to ensure freshness!</p>
              </div>
            </div>
            <div id="pickup-details" style="display: none;">
              <p>Pickup available at our store location:</p>
              <p>
                <strong>11am Coffee Shop</strong>
                <br>Currently Not available
              </p>
            </div>
          </div>
          <!-- Customer Details -->
          <div class="customer-details">
            <h3>Customer Details</h3>
            <form id="customer-form">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="name">Full Name</label>
                  <input type="text" class="form-input" id="name" required>
                  <small id="nameMsg" style="color:red;display:none;">⚠️ Please enter a valid Name</small>
                </div>
                <div class="form-group">
                  <label class="form-label" for="phone">Phone Number</label>
                  <input type="tel" class="form-input" id="phone" placeholder="+60..." required>
                  <small id="phoneMsg" style="color:red;display:none;">⚠️ Please enter a valid Malaysian phone number</small>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label" for="email">Email Address</label>
                <input type="email" class="form-input" id="email" placeholder="example@email.com" required>
                <small id="emailError" style="color:red; display:none;">⚠️ Please enter a valid email address</small>
              </div>
              <div class="form-group" id="address-field">
                <label class="form-label" for="address">Delivery Address</label>
                <textarea class="form-input" id="address" rows="3" required></textarea>
              </div>
              <!-- ✅ Promo Code -->
              <div class="form-group">
                <label class="form-label" for="promo">Promo Code (Optional)</label>
                <input type="text" class="form-input" id="promo" placeholder="Enter your promo code">
                <small id="promoMsg" style="color:green;display:none;">✅ Promo code applied!</small>
              </div>
              <!-- <div class="form-group"> -->
              <!-- <label class="form-label" for="notes">Special Instructions (Optional)</label> -->
              <!-- <textarea class="form-input" id="notes" rows="2" placeholder="Any special requests or notes for your order"></textarea> -->
              <!-- </div> -->
            </form>
          </div>
          <!-- Order Summary -->
          <div class="order-summary">
            <h3>Order Summary</h3>
            <div id="summary-items">
              <div class="summary-item">
                <span>Items:</span>
                <span id="items-total">RM 0.00</span>
              </div>
              <div class="summary-item">
                <span>Delivery(Estimate Fee Only):</span>
                <span id="delivery-fee">RM 0.00</span>
              </div>
              <div class="summary-total">
                <span>Total:</span>
                <span id="order-total">RM 0.00</span>
              </div>
            </div>
          </div>
          <!-- Buttons -->
          <div class="btn-group">
            <button class="btn btn-secondary" id="back-btn">Back</button>
            <button class="btn btn-primary" id="continue-btn">Continue to Payment</button>
          </div>
          <!-- Error / status messages -->
          <div id="formMsg" style="margin-top:10px; font-weight:bold; text-align:center;"></div>
        </div>
      </div>
    </section>
    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <!-- Column 1 -->
          <div class="footer-column">
            <h3>11am Coffee</h3>
            <p> Brewing joy in every cup — <br> 11am Coffee, your daily ritual since 2025. </p>
          </div>
          <!-- Column 2 -->
          <div class="footer-column">
            <h3>Contact Us</h3>
            <ul>
              <li>
                <i class="fas fa-phone"></i>
                <a href="tel:+60175115356">+60 17-511 5356</a>
              </li>
              <li>
                <i class="fab fa-whatsapp"></i>
                <a href="https://wa.me/60175115356" target="_blank">Message us on WhatsApp</a>
              </li>
            </ul>
          </div>
          <!-- Column 3 (NEW Quick Links) -->
          <div class="footer-column">
            <h3>Quick Links</h3>
            <ul>
              <li>
                <a href="index.html">Home</a>
              </li>
              <li>
                <a href="order.html">Place Order</a>
              </li>
              <li>
                <a href="index.html#feedback-form">Feedback</a>
              </li>
            </ul>
          </div>
          <!-- Column 4 -->
          <div class="footer-column">
            <h3>Follow Us</h3>
            <div class="social-icons">
              <a href="https://www.instagram.com/11amcoffee/" target="_blank">
                <i class="fab fa-instagram"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="copyright">
          <p>&copy;2025 11 AM COFFEE 202503256298(CT0154839-U) • All rights reserved.</p>
        </div>
      </div>
    </footer>
    <!-- Date & Time Picker Modal -->
    <div class="modal-overlay-datetime" id="dateTimeModal">
      <div class="modal-content">
        <div class="datepicker-header">
          <div class="datepicker-month-year" id="currentMonthYear">October 2025</div>
        </div>
        <div class="datepicker-days-header">
          <div>SUN</div>
          <div>MON</div>
          <div>TUE</div>
          <div>WED</div>
          <div>THU</div>
          <div>FRI</div>
          <div>SAT</div>
        </div>
        <div class="datepicker-days-grid" id="daysGrid"></div>
        <div class="datepicker-navigation">
          <button type="button" class="nav-btn" id="prevMonth">‹ Previous</button>
          <button type="button" class="nav-btn" id="todayBtn">Today</button>
          <button type="button" class="nav-btn" id="nextMonth">Next ›</button>
        </div>
        <div class="modal-footer">
          <div class="selected-display" id="selectedDateDisplay"> No date selected </div>
          <!-- Time Picker Section -->
          <div class="time-picker-section" style="margin: 20px 0;">
            <div class="section-title" style="font-size: 18px; margin-bottom: 15px;">Delivery Time</div>
            <div class="time-group-title">Evening Delivery (6:00 PM - 9:00 PM)</div>
            <div class="time-slots-grid">
              <button type="button" class="time-slot" data-time="12:00 - 15:00">12:00 PM - 3:00 PM</button>
              <button type="button" class="time-slot" data-time="15:00 - 18:00">3:00 PM - 6:00 PM</button>
              <button type="button" class="time-slot" data-time="18:00 - 21:00">6:00 PM - 9:00 PM</button>
            </div>
          </div>
          <div class="action-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDateTimePicker()">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmDateTimeBtn" onclick="confirmDateTime()" disabled>Select Date & Time</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Postcode Checker Modal -->
    <div class="modal-overlay" id="postcodeModal">
      <div class="postcode-modal">
        <button class="modal-close" id="modalClose"></button>
        <div class="order-card">
          <div class="content">
            <h2>Check delivery by postcode</h2>
            <p class="muted">Enter your postcode and we'll tell you whether we deliver to your area (within 10 km of Pandan Perdana, KL 55330).</p>
            <label for="postcode">Postcode</label>
            <input id="postcode" type="text" inputmode="numeric" placeholder="e.g. 55330" aria-describedby="hint" />
            <small id="hint">Malaysian format: 5 digits.</small>
          </div>
          <button id="checkBtn" class="check-btn" style="padding:12px; font-size:15px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;">Check</button>
          <!-- Check result output -->
          <div id="output" class="result" aria-live="polite" style="display:none; margin-top:12px;"></div>
          <!-- ✅ Done button (hidden until result shown) -->
          <button id="doneBtn" style="display:none; margin-top:15px; padding:10px 18px; font-size:14px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;">Done</button>
        </div>
      </div>
    </div>
    <!-- ✅ Order Checker Modal -->
    <div class="modal-overlay" id="orderModal">
      <div class="postcode-modal">
        <button class="modal-close" id="orderModalClose"></button>
        <div class="order-card">
          <div class="content">
            <h2>Check your order</h2>
            <p class="muted">Enter your Order ID to track your order status.</p>
            <label for="orderId">Order ID</label>
            <input id="orderId" type="text" placeholder="e.g. ORD12345" aria-describedby="orderHint" />
            <small id="orderHint">Your Order ID is provided after checkout.</small>
          </div>
          <!-- ✅ Button inside modal to check -->
          <button id="checkOrderBtn" class="check-btn" style="padding:12px; font-size:15px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;"> Check Order </button>
          <!-- Result -->
          <div id="orderOutput" class="result" aria-live="polite" style="display:none; margin-top:12px;"></div>
          <!-- Done button -->
          <button id="orderDoneBtn" style="display:none; margin-top:15px; padding:10px 18px; font-size:14px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;"> Done </button>
        </div>
      </div>
    </div>
    <!-- Print Template (hidden on screen) -->
    <div id="printTemplate">
      <div class="print-container">
        <div class="print-header">
          <h1 class="print-title">Order Confirmation</h1>
          <p>Thank you for your purchase!</p>
        </div>
        <div class="print-detail">
          <div class="print-label">Customer Name</div>
          <div class="print-value" id="printName"></div>
        </div>
        <div class="print-detail">
          <div class="print-label">Estimated Delivery</div>
          <div class="print-value" id="printDelivery">2-3 business days</div>
        </div>
        <div class="print-detail">
          <div class="print-label">Order ID</div>
          <div class="print-value" id="printOrderId" style="font-size:20px; font-weight:bold; color:#2196F3; letter-spacing:1px;">EL0000000000</div>
        </div>
        <div class="print-footer">
          <p>Please keep this receipt for your records</p>
          <p>Contact us if you have any questions</p>
        </div>
      </div>
    </div>
    <script>
      // Postcode Checker Functionality
      const dateTimeModal = document.getElementById('dateTimeModal');
      // Date & Time Picker Functionality
      let selectedDate = null;
      let selectedTime = null;
      let currentDate = new Date();
      const minDate = new Date();
      minDate.setDate(minDate.getDate() + 3); // Minimum 3 days in advance
      // Initialize date/time picker
      function initializeDateTimePicker() {
        renderCalendar();
        setupDateTimeEventListeners();
        updateTimeSlots(); // Initialize time slots based on current selection
      }

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const monthYearElement = document.getElementById('currentMonthYear');
        const daysGrid = document.getElementById('daysGrid');
        monthYearElement.textContent = formatMonthYear(year, month);
        daysGrid.innerHTML = '';
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();
        // Previous month days
        const prevMonthLastDay = new Date(year, month, 0).getDate();
        for (let i = startingDay - 1; i >= 0; i--) {
          createDayElement(prevMonthLastDay - i, 'other-month', true);
        }
        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(year, month, day);
          const isDisabled = date < minDate;
          const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
          const isToday = isTodayDate(date);
          let className = '';
          if (isSelected) className = 'selected';
          if (isDisabled) className = 'disabled';
          if (isToday && !isSelected && !isDisabled) className = 'today';
          createDayElement(day, className, isDisabled, date);
        }
        // Next month days
        const totalCells = 42;
        const remainingCells = totalCells - (startingDay + daysInMonth);
        for (let day = 1; day <= remainingCells; day++) {
          createDayElement(day, 'other-month', true);
        }
      }

      function createDayElement(day, className, disabled, date) {
        const dayElement = document.createElement('button');
        dayElement.type = 'button';
        dayElement.className = `datepicker-day ${className}`;
        dayElement.textContent = day;
        dayElement.disabled = disabled;
        if (date && !disabled) {
          dayElement.addEventListener('click', function() {
            selectDate(date);
          });
        }
        document.getElementById('daysGrid').appendChild(dayElement);
      }

      function selectDate(date) {
        selectedDate = date;
        selectedTime = null; // Reset time when date changes
        // Update time slots based on weekday/weekend
        updateTimeSlots();
        document.getElementById('confirmDateTimeBtn').disabled = !selectedTime;
        document.getElementById('selectedDateDisplay').textContent = `Selected: ${date.toLocaleDateString('en-US', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    })}`;
        renderCalendar();
      }

      function selectTime(element) {
        if (element.disabled) return;
        // Remove selected class from all time slots
        document.querySelectorAll('.time-slot').forEach(slot => {
          slot.classList.remove('selected');
        });
        // Add selected class to clicked time slot
        element.classList.add('selected');
        // Store selected time
        selectedTime = element.getAttribute('data-time');
        // Enable confirm button if date is also selected
        document.getElementById('confirmDateTimeBtn').disabled = !selectedDate;
      }
      // NEW FUNCTION: Update time slots based on selected date
      function updateTimeSlots() {
        const timeSlots = document.querySelectorAll('.time-slot');
        if (!selectedDate) {
          // No date selected - enable all time slots
          timeSlots.forEach(slot => {
            slot.disabled = false;
            slot.style.opacity = '1';
            slot.style.cursor = 'pointer';
          });
          return;
        }
        const dayOfWeek = selectedDate.getDay(); // 0 = Sunday, 6 = Saturday
        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
        timeSlots.forEach(slot => {
          const timeRange = slot.getAttribute('data-time');
          const startHour = parseInt(timeRange.split(':')[0]);
          if (isWeekend) {
            // Weekend: enable all slots from 12:00 onwards
            slot.disabled = false;
            slot.style.opacity = '1';
            slot.style.cursor = 'pointer';
          } else {
            // Weekday (1-5): only enable slots from 18:00 (6 PM) onwards
            if (startHour >= 18) {
              slot.disabled = false;
              slot.style.opacity = '1';
              slot.style.cursor = 'pointer';
            } else {
              slot.disabled = true;
              slot.style.opacity = '0.5';
              slot.style.cursor = 'not-allowed';
            }
          }
          // Remove selected state if switching from weekend to weekday and time becomes invalid
          if (slot.classList.contains('selected') && slot.disabled) {
            slot.classList.remove('selected');
            selectedTime = null;
            document.getElementById('confirmDateTimeBtn').disabled = true;
          }
        });
        // Update display to show current restrictions
        updateDateTimeDisplay();
      }
      // NEW FUNCTION: Update the display text with restrictions info
      function updateDateTimeDisplay() {
        const displayElement = document.getElementById('selectedDateDisplay');
        if (selectedDate) {
          const dateStr = selectedDate.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          const dayType = (selectedDate.getDay() === 0 || selectedDate.getDay() === 6) ? 'weekend' : 'weekday';
          const timeRestriction = dayType === 'weekday' ? '6:00 PM - 9:00 PM' : '12:00 PM - 9:00 PM';
          if (selectedTime) {
            const timeDisplay = document.querySelector('.time-slot.selected').textContent;
            displayElement.textContent = `${dateStr} at ${timeDisplay}`;
          } else {
            displayElement.textContent = `${dateStr} - Available: ${timeRestriction}`;
          }
        } else {
          displayElement.textContent = 'No date selected';
        }
      }

      function formatMonthYear(year, month) {
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        return `${months[month]} ${year}`;
      }

      function isTodayDate(date) {
        const today = new Date();
        return date.toDateString() === today.toDateString();
      }

      function formatTime(timeString) {
        const [hours, minutes] = timeString.split(':');
        const hour = parseInt(hours);
        const period = hour >= 12 ? 'PM' : 'AM';
        const displayHour = hour % 12 || 12;
        return `${displayHour}:${minutes} ${period}`;
      }
      // Modal Functions
      function openDateTimePicker() {
        console.log("open model");
        dateTimeModal.classList.add('active');
        document.getElementById('dateTimeModal').style.display = 'flex';
        initializeDateTimePicker();
      }

      function closeDateTimePicker() {
        console.log("close");
        document.getElementById('dateTimeModal').style.display = 'none';
      }

      function confirmDateTime() {
        if (selectedDate && selectedTime) {
          // Format for database/storage (YYYY-MM-DD HH:MM - HH:MM)
          const dbDate = selectedDate.toISOString().split('T')[0]; // YYYY-MM-DD
          // Get the time range from the button's data-time attribute
          const timeRange = document.querySelector(`.time-slot[data-time="${selectedTime}"]`).getAttribute('data-time');
          // Combine date and time range
          const dbDateTimeRange = `${dbDate} ${timeRange}`; // 2025-10-25 12:00 - 15:00
          // Update the delivery datetime input with the formatted range
          document.getElementById('delivery-datetime').value = dbDateTimeRange;
          // Store the database format in a data attribute for form submission
          document.getElementById('delivery-datetime').setAttribute('data-db-format', dbDateTimeRange);
          console.log('Database format:', dbDateTimeRange);
          console.log('Is weekend?', (selectedDate.getDay() === 0 || selectedDate.getDay() === 6));
          // Close modal
          closeDateTimePicker();
        }
      }

      function setupDateTimeEventListeners() {
        // Date picker navigation
        document.getElementById('prevMonth').addEventListener('click', function() {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar();
        });
        document.getElementById('nextMonth').addEventListener('click', function() {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar();
        });
        document.getElementById('todayBtn').addEventListener('click', function() {
          currentDate = new Date();
          renderCalendar();
        });
        // Time slot selection
        document.querySelectorAll('.time-slot').forEach(slot => {
          slot.addEventListener('click', function() {
            selectTime(this);
          });
        });
        // Close modal when clicking overlay
        document.getElementById('dateTimeModal').addEventListener('click', function(e) {
          if (e.target === this) {
            closeDateTimePicker();
          }
        });
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && document.getElementById('dateTimeModal').style.display === 'flex') {
            closeDateTimePicker();
          }
        });
      }
      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', function() {
        // Make the delivery datetime input clickable to open picker
        document.getElementById('delivery-datetime').addEventListener('click', openDateTimePicker);
        document.getElementById('delivery-datetime').readOnly = true; // Make it read-only
      });
    </script>
    <script type="module">
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const navMenu = document.getElementById('navMenu');
      mobileMenuBtn.addEventListener('click', () => {
        navMenu.classList.toggle('active');
        const icon = mobileMenuBtn.querySelector('i');
        if (navMenu.classList.contains('active')) {
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        } else {
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        }
      });
      document.addEventListener("DOMContentLoaded", function() {
        const quantityInputs = document.querySelectorAll(".quantity-input");
        const steps = document.querySelectorAll(".step");
        const checkPostcodeBtn = document.getElementById("checkPostcode");
        const postcodeInput = document.getElementById("postcodeorder");
        const deliveryResult = document.getElementById("delivery-result");
        const nameInput = document.getElementById("name");
        const phoneInput = document.getElementById("phone");
        const emailInput = document.getElementById("email");
        const addressInput = document.getElementById("address");
        // ---- STEP PROGRESS HANDLER ----
        function setActiveSteps(stepIndex) {
          steps.forEach((step, index) => {
            if (index <= stepIndex) {
              step.classList.add("active");
            } else {
              step.classList.remove("active");
            }
          });
        }
        // ---- PRODUCT SELECTION ----
        function updateStepProgress() {
          let hasProduct = false;
          quantityInputs.forEach(input => {
            if (parseInt(input.value) > 0) {
              hasProduct = true;
            }
          });
          if (hasProduct) {
            setActiveSteps(1); // Step 1 + Step 2
          } else {
            setActiveSteps(0); // Only Step 1
          }
        }
        quantityInputs.forEach(input => {
          input.addEventListener("input", updateStepProgress);
        });
        document.querySelectorAll(".quantity-btn").forEach(btn => {
          btn.addEventListener("click", function() {
            const input = this.parentElement.querySelector(".quantity-input");
            let currentValue = parseInt(input.value);
            if (this.classList.contains("plus") && currentValue < input.max) {
              input.value = currentValue;
            } else if (this.classList.contains("minus") && currentValue > input.min) {
              input.value = currentValue;
            }
            updateStepProgress();
            updateOrderSummary();
          });
        });
        // ---- CUSTOMER DETAILS CHECK ----
        function checkCustomerDetails() {
          if (nameInput.value.trim() !== "" && phoneInput.value.trim() !== "" && emailInput.value.trim() !== "" && addressInput.value.trim() !== "") {
            setActiveSteps(3); // Step 1 + 2 + 3 + 4
          }
        }
        [nameInput, phoneInput, emailInput, addressInput].forEach(input => {
          input.addEventListener("input", checkCustomerDetails);
        });
      });
      // Postcode Checker Functionality
      const deliveryCheckBtn = document.getElementById('deliveryCheckBtn');
      const deliveryCheckBtnNav = document.getElementById('deliveryCheckBtnNav'); // ✅ nav version
      const postcodeModal = document.getElementById('postcodeModal');
      const modalClose = document.getElementById('modalClose');
      const checkBtn = document.getElementById('checkBtn');
      const doneBtn = document.getElementById('doneBtn'); // ✅ added
      const postcodeInput = document.getElementById('postcode');
      const output = document.getElementById('output');
      // Open modal
      function openPostcodeModal() {
        postcodeModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
      deliveryCheckBtn.addEventListener('click', openPostcodeModal);
      if (deliveryCheckBtnNav) {
        deliveryCheckBtnNav.addEventListener('click', openPostcodeModal);
      }
      // Reset when typing new postcode
      postcodeInput.addEventListener("input", function() {
        checkBtn.style.display = "inline-block"; // show Check
        doneBtn.style.display = "none"; // hide Done
        output.style.display = "none"; // hide old result
      });
      // Close modal
      function closePostcodeModal() {
        postcodeModal.classList.remove('active');
        document.body.style.overflow = '';
      }
      modalClose.addEventListener('click', closePostcodeModal);
      // Close when clicking outside modal
      postcodeModal.addEventListener('click', (e) => {
        if (e.target === postcodeModal) {
          closePostcodeModal();
        }
      });
      // Close with ESC key
      document.addEventListener('keydown', (e) => {
        if (e.key === "Escape" && postcodeModal.classList.contains('active')) {
          closePostcodeModal();
        }
      });
      // --- Postcode Checker Configuration ---
      const originLat = 3.1345;
      const originLng = 101.7432;
      const maxKm = 11; // allow up to 20 km
      function normalize(pc) {
        if (!pc) return '';
        return pc.replace(/\s+/g, '');
      }

      function isValidMalaysianPostcode(pc) {
        return /^\d{5}$/.test(pc);
      }

      function haversineDistance(lat1, lon1, lat2, lon2) {
        function toRad(x) {
          return x * Math.PI / 180
        }
        const R = 6371;
        const dLat = toRad(lat2 - lat1);
        const dLon = toRad(lon2 - lon1);
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
      }
      async function geocodePostcode(postcode) {
        const url = `https://nominatim.openstreetmap.org/search?postalcode=${encodeURIComponent(postcode)}&country=Malaysia&format=json`;
        const res = await fetch(url, {
          headers: {
            'User-Agent': 'CoffeeDeliveryApp/1.0'
          }
        });
        const json = await res.json();
        if (json && json.length) {
          return {
            lat: parseFloat(json[0].lat),
            lng: parseFloat(json[0].lon)
          };
        }
        throw new Error('No results found');
      }
      // --- Delivery Rate Configuration ---
      const baseRates = {
        motorcycle: {
          base: 4,
          perKm: 1.5
        },
        car: {
          base: 7,
          perKm: 1.8
        },
        van: {
          base: 25,
          perKm: 3.5
        }
      };
      // Grab-style capped pricing for motorcycles
      function calculateDeliveryCost(distanceKm) {
        let rate = baseRates.motorcycle;
        let rawCost = rate.base + (rate.perKm * distanceKm);
        if (distanceKm <= 5) {
          return 7; // flat min RM7
        } else if (distanceKm <= 15) {
          return Math.min(rawCost, 19); // cap at RM19
        } else {
          return Math.round(rawCost); // beyond 15 km, round to whole RM
        }
      }
      checkBtn.addEventListener('click', async () => {
        const raw = postcodeInput.value;
        const pc = normalize(raw);
        output.style.display = 'block';
        if (!pc) {
          output.className = 'result no';
          output.textContent = 'Please enter a postcode.';
          return;
        }
        if (!isValidMalaysianPostcode(pc)) {
          output.className = 'result no';
          output.innerHTML = 'Invalid postcode format. Postcode should be exactly 5 digits.';
          return;
        }
        try {
          output.className = 'result';
          output.textContent = 'Checking postcode location and calculating delivery cost…';
          const {
            lat,
            lng
          } = await geocodePostcode(pc);
          const km = haversineDistance(originLat, originLng, lat, lng);
          const deliveryCost = calculateDeliveryCost(km);
          if (km < maxKm) {
            // ✅ Show Done button after result
            doneBtn.style.display = "inline-block";
            // ✅ Hide Check button
            checkBtn.style.display = "none";
            const postcodeOrderEl = document.getElementById("postcodeorder");
            if (postcodeOrderEl) {
              if (postcodeOrderEl.tagName === "INPUT") {
                postcodeOrderEl.value = pc; // store value for form submission
              } else {
                postcodeOrderEl.textContent = pc; // fallback if it's just a span/div
              }
            }
            const resultDivE1 = document.getElementById('delivery-result');
            resultDivE1.className = 'delivery-result available';
            resultDivE1.textContent = `Estimated delivery fee: RM ${Math.round(deliveryCost)}`;
            document.getElementById('delivery-fee').textContent = `RM ${Math.round(deliveryCost)}`;
            updateOrderSummary();
            output.className = 'result ok';
            output.innerHTML = `Good news — we deliver to 
         												
         														
																																				<strong>${pc}</strong> (≈${Math.round(km)} km away)!
         												
         														
																																				<br>
                                       Estimated delivery fee: 
         													
         															
																																					<strong>RM${Math.round(deliveryCost)}</strong>`;
          } else {
            doneBtn.style.display = "inline-block";
            // ✅ Hide Check button
            checkBtn.style.display = "none";
            output.className = 'result no';
            output.innerHTML = `Sorry, 
         													
         															
																																					<strong>${pc}</strong> is about ${Math.round(km)} km away, which is outside our ${maxKm} km delivery zone.`;
          }
        } catch (err) {
          output.className = 'result no';
          output.textContent = 'Could not find this postcode. Please check and try again.';
        }
      });
      postcodeInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') checkBtn.click();
      });
      // Quantity controls
      document.querySelectorAll('.quantity-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const product = this.getAttribute('data-product');
          const input = document.getElementById(`${product}-qty`);
          let value = parseInt(input.value);
          if (this.classList.contains('plus')) {
            value = Math.min(value + 1, parseInt(input.max));
          } else if (this.classList.contains('minus')) {
            value = Math.max(value - 1, parseInt(input.min));
          }
          input.value = value;
          updateOrderSummary();
        });
      });
      // Delivery/Pickup toggle
      const deliveryOption = document.getElementById('delivery-option');
      const pickupOption = document.getElementById('pickup-option');
      const deliveryDetails = document.getElementById('delivery-details');
      const pickupDetails = document.getElementById('pickup-details');
      const addressField = document.getElementById('address-field');
      deliveryOption.addEventListener('click', () => {
        deliveryOption.classList.add('active');
        pickupOption.classList.remove('active');
        deliveryDetails.style.display = 'block';
        pickupDetails.style.display = 'none';
        addressField.style.display = 'block';
        document.getElementById('address').required = true;
        updateOrderSummary();
      });
      pickupOption.addEventListener('click', () => {
        pickupOption.classList.add('active');
        deliveryOption.classList.remove('active');
        deliveryDetails.style.display = 'none';
        pickupDetails.style.display = 'block';
        addressField.style.display = 'none';
        document.getElementById('address').required = false;
        updateOrderSummary();
      });
      document.getElementById('checkPostcode').addEventListener('click', openPostcodeModal);
      if (deliveryCheckBtnNav) {
        deliveryCheckBtnNav.addEventListener('click', openPostcodeModal);
      }
      // Update order summary
      function updateOrderSummary() {
        const singleQty = parseInt(document.getElementById('singlebrew-qty').value) || 0;
        const coupleQty = parseInt(document.getElementById('couplebrew-qty').value) || 0;
        const familyQty = parseInt(document.getElementById('familybrew-qty').value) || 0;
        const singlePrice = 36;
        const couplePrice = 70;
        const familyPrice = 105;
        let itemsTotal = (singleQty * singlePrice) + (coupleQty * couplePrice) + (familyQty * familyPrice);
        const deliveryEl = document.getElementById('delivery-fee');
        const resultDiv = document.getElementById('delivery-result');
        // ✅ Always extract original delivery fee from resultDiv
        let baseDeliveryFee = 0;
        const feeMatch = resultDiv.innerHTML.match(/RM\s*(\d+\.?\d*)/);
        if (feeMatch) {
          baseDeliveryFee = parseFloat(feeMatch[1]);
        }
        let deliveryFee = baseDeliveryFee;
        // ✅ Apply delivery discount if itemsTotal >= 103.90
        if (itemsTotal >= 103.90 && baseDeliveryFee > 0) {
          const discount = Math.min(8, baseDeliveryFee); // max RM8 off
          const discountedFee = baseDeliveryFee - discount;
          deliveryEl.textContent = `RM ${discountedFee.toFixed(2)} (discount applied, was RM ${baseDeliveryFee.toFixed(2)})`;
          deliveryFee = discountedFee;
        } else {
          // ❌ Restore original delivery fee from resultDiv
          deliveryEl.textContent = `RM ${baseDeliveryFee.toFixed(2)}`;
          deliveryFee = baseDeliveryFee;
        }
        // ✅ Apply promo code discount
        const promoInput = document.getElementById('promo');
        const promoMsg = document.getElementById('promoMsg');
        let promoDiscount = 0;
        if (promoInput && promoInput.value.trim().toUpperCase() === "11AMFIRSTUSER") {
          promoDiscount = 5; // RM5 discount
          promoMsg.style.display = "block";
          promoMsg.style.color = "green";
          promoMsg.textContent = "✅ Promo code applied: -RM5";
        } else if (promoInput && promoInput.value.trim() !== "") {
          promoMsg.style.display = "block";
          promoMsg.style.color = "red";
          promoMsg.textContent = "❌ Invalid promo code";
        } else {
          promoMsg.style.display = "none";
        }
        // ✅ Final totals
        const grandTotal = itemsTotal + deliveryFee - promoDiscount;
        document.getElementById('items-total').textContent = `RM ${itemsTotal.toFixed(2)}`;
        document.getElementById('order-total').textContent = `RM ${grandTotal.toFixed(2)}`;
      }
      // Initialize order summary
      updateOrderSummary();
      // Back button
      document.getElementById('back-btn').addEventListener('click', function() {
        window.history.back();
      });
      // ✅ Handle Continue Button
      document.getElementById("continue-btn").addEventListener("click", async function() {
        const msgEl = document.getElementById("formMsg");
        msgEl.style.color = "red"; // default red for errors
        // Collect selected products
        let selected = [];
        const products = ["singlebrew", "couplebrew", "familybrew"];
        products.forEach(p => {
          const qty = parseInt(document.getElementById(`${p}-qty`).value) || 0;
          if (qty > 0) {
            selected.push({
              product: p,
              qty: qty
            });
          }
        });
        if (selected.length === 0) {
          msgEl.textContent = "⚠️ Please select at least one product.";
          return;
        }
        // Delivery postcode check
        const postcode = document.getElementById("postcodeorder").value.trim();
        if (!postcode) {
          msgEl.textContent = "⚠️ Please check your delivery postcode before continuing.";
          return;
        }
        // Customer details
        const custdeliverytime = document.getElementById("delivery-datetime").value.trim();
        const custName = document.getElementById("name").value.trim();
        const custPhone = document.getElementById("phone").value.trim();
        const custEmail = document.getElementById("email").value.trim();
        const custAddress = document.getElementById("address").value.trim();
        const promoCode = document.getElementById('promo').value.trim();
        if (!custName || !custPhone || !custEmail || !custAddress) {
          msgEl.textContent = "⚠️ Please fill in all customer details.";
          return;
        }
        if (!custdeliverytime) {
          msgEl.textContent = "⚠️ Please Select Delivery DateTime";
          return;
        }
        // Phone validation
        const phoneRegex = /^(?:\+60\d{9,10}|0\d{8,9})$/;
        if (!phoneRegex.test(custPhone)) {
          msgEl.textContent = "⚠️ Please enter a valid phone number (e.g., +60123456789 or 0143810530).";
          return;
        }
        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(custEmail)) {
          msgEl.textContent = "⚠️ Please enter a valid email (e.g., example@email.com).";
          return;
        }
        // Totals
        const orderTotal = document.getElementById("items-total").textContent;
        const deliveryFee = document.getElementById("delivery-fee").textContent;
        const grandTotal = document.getElementById("order-total").textContent;
        // Payload
        const payload = {
          CustName: custName,
          Phone: custPhone,
          Email: custEmail,
          Address: custAddress,
          Orders: selected,
          OrderPrice: orderTotal,
          DeliveryFee: deliveryFee,
          GrandTotal: grandTotal,
          DateTime: new Date().toLocaleString("en-GB", {
            timeZone: "Asia/Kuala_Lumpur"
          }),
          Status: "New",
          DeliveryTime: custdeliverytime,
          Promotion: promoCode
        };
        console.log("Final Payload 👉", payload);
        // Status: loading
        msgEl.textContent = "⏳ Placing your order, please wait...";
        msgEl.style.color = "blue";
        const btn = document.getElementById("continue-btn");
        btn.disabled = true;
        btn.textContent = "Submitting Order...";
        try {
          // 🔗 Call Cloudflare Worker instead of Firebase
          const response = await fetch("https://gentle-grass-be7d.11amcoffeebackoffice.workers.dev/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(payload),
          });
          const result = await response.json();
          console.log("Worker Response 👉", result);
          if (result.success) {
            const newOrderId = result.orderId;
            document.getElementById("printOrderId").textContent = newOrderId;
            document.getElementById("printName").textContent = custName;
            sessionStorage.setItem("selectedOrders", JSON.stringify(payload));
            setTimeout(() => {
              window.location.replace(`payment.html?orderId=${newOrderId}&name=${encodeURIComponent(custName)}&deliveryfee=${encodeURIComponent(deliveryFee)}&ordertotal=${encodeURIComponent(orderTotal)}&grandtotal=${encodeURIComponent(grandTotal)}&promocode=${encodeURIComponent(promoCode)}&address=${encodeURIComponent(custAddress)}`);
            }, 2000);
          } else {
            btn.disabled = false;
            btn.textContent = "Continue to Payment";
            msgEl.textContent = "⚠️ Failed to save order: " + (result.error || "Unknown error");
          }
        } catch (err) {
          btn.disabled = false;
          btn.textContent = "Continue to Payment";
          console.error("❌ Error:", err);
          msgEl.textContent = "⚠️ Failed to save order, please try again.";
        }
      });
      // Close modal with Done button
      document.getElementById("doneBtn").addEventListener("click", function() {
        postcodeModal.classList.remove('active');
        document.body.style.overflow = '';
      });
      //Phone Verification
      const phoneInput = document.getElementById("phone");
      const phoneMsg = document.getElementById("phoneMsg");
      // Auto-add +60 if missing
      phoneInput.addEventListener("focus", () => {
        if (!phoneInput.value.startsWith("+60")) {
          phoneInput.value = "+60";
        }
      });
      // Validate on blur or input
      phoneInput.addEventListener("input", () => {
        // 🔥 Remove all spaces automatically
        phoneInput.value = phoneInput.value.replace(/\s+/g, "");
        validatePhone();
      });

      function normalizePhone(input) {
        let phone = input.replace(/\s+/g, ""); // remove spaces
        // If starts with 0 (like 014...), replace leading 0 with +60
        if (/^0\d{8,9}$/.test(phone)) {
          phone = "+60" + phone.substring(1);
        }
        // If already starts with +60, leave it
        return phone;
      }

      function validatePhone() {
        phoneInput.value = normalizePhone(phoneInput.value);
        const phone = phoneInput.value.trim();
        const regex = /^\+60\d{9,10}$/;
        if (regex.test(phone)) {
          phoneMsg.style.display = "none";
          phoneInput.style.borderColor = "green";
          return true;
        } else {
          phoneMsg.style.display = "block";
          phoneInput.style.borderColor = "red";
          return false;
        }
      }
      //Name Verification
      const nameInput = document.getElementById("name");
      const nameMsg = document.getElementById("nameMsg");
      // Validate on blur or input
      nameInput.addEventListener("input", () => {
        validateName();
      });

      function validateName() {
        const name = nameInput.value.trim();
        // Regex: +60, followed by 9–10 digits
        const regex = /^\+60\d{9,10}$/;
        if (name) {
          nameMsg.style.display = "none"; // ✅ valid
          nameInput.style.borderColor = "green";
          return true;
        } else {
          nameMsg.style.display = "block"; // ❌ invalid
          nameInput.style.borderColor = "red";
          return false;
        }
      }
      const promoInput = document.getElementById('promo');
      if (promoInput) {
        promoInput.addEventListener('input', () => {
          // Auto-uppercase the input
          promoInput.value = promoInput.value.toUpperCase();
          // Recalculate totals whenever promo changes
          updateOrderSummary();
        });
      }
      const emailInput = document.getElementById("email");
      const emailError = document.getElementById("emailError");
      emailInput.addEventListener("input", function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailInput.value.trim() === "") {
          emailError.style.display = "none"; // hide if empty
        } else if (!emailRegex.test(emailInput.value)) {
          emailError.style.display = "inline";
        } else {
          emailError.style.display = "none"; // valid email
        }
      });
    </script>
    <script src="Modal/modalscript.js"></script>
  </body>
</html>