<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Place Order - 11am Coffee</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Open+Sans:wght@400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <!-- Include Flatpickr CSS & JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr">
  </script>
  <!-- Confetti -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
  <link rel="stylesheet" href="modal\modelstyle.css">
	<!-- Favicon -->
	<link rel="icon" href="images/11amV2.ico" type="image/x-icon">
	<link rel="shortcut icon" href="images/11amV2.ico" type="image/x-icon">

	<!-- Optional for better support -->
	<link rel="apple-touch-icon" sizes="180x180" href="images/11amV2.ico">
	<link rel="icon" type="image/png" sizes="32x32" href="images/11amV2.ico">
	<link rel="icon" type="image/png" sizes="16x16" href="images/11amV2.ico">
  
  <style>
    .announcement-bar {
      background: #5c4435;
      color: #fff;
      padding: 8px 16px;
      border-bottom: 1px solid #e0d9b9;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      overflow: hidden;
      white-space: nowrap;
    }

    .announcement-bar .announcement-full {
      display: inline-block;
      max-width: 900px;
    }

    @media (max-width: 768px) {
      .announcement-bar i {
        display: none;
      }

      .announcement-bar .announcement-short {
        display: inline-block;
        white-space: nowrap;
        animation: marquee 10s linear infinite;
        will-change: transform;
      }

      @keyframes marquee {
        from {
          transform: translateX(100%);
        }

        to {
          transform: translateX(-100%);
        }
      }
    }

    .tagline {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      font-style: italic;
      color: #3a2c1e;
    }

    .tagline-hero {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      font-style: italic;
      font-weight: 400;
      color: #f5f0ea;
      margin-top: 10px;
      line-height: 1.6;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .mobile-actions {
      display: none;
      gap: 10px;
    }

    @media (max-width: 768px) {
      .mobile-actions {
        display: flex;
        align-items: center;
      }

      .nav-menu .icon-btn {
        display: none;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background-color: #f9f5f0;
      color: #3a2c1e;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Premium Header */
    header {
      background: #fff;
      padding: 15px 5%;
      box-shadow: 0 2px 10px rgba(59, 42, 33, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-style: italic;
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, #3b2a21, #b08d57);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 2px;
      flex: 1;
      text-align: left;
      cursor: pointer;
      transition: transform 0.3s ease, background 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
      background: linear-gradient(135deg, #7a5c44, #d4a373);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .logo span {
      color: #d4af37;
      font-weight: 700;
      font-style: italic;
      opacity: 0.85;
    }

    .nav-menu {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .nav-link {
      text-decoration: none;
      color: #3b2a21;
      font-weight: 500;
      font-size: 16px;
      transition: all 0.3s ease;
      position: relative;
      padding: 5px 0;
    }

    .nav-link:hover {
      color: #7a5c44;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #3b2a21, #7a5c44);
      transition: width 0.3s ease;
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .icon-btn,
    .mobile-menu-btn {
      background: none;
      border: none;
      color: #3b2a21;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      transition: 0.3s;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover,
    .mobile-menu-btn:hover {
      background-color: #f3ebe4;
      transform: scale(1.05);
    }

    .mobile-menu-btn {
      display: none;
    }

    /* Order Page Specific Styles */
    .order-section {
      padding: 60px 0;
      background-color: #fff;
    }

    .order-container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      font-size: 36px;
      margin-bottom: 20px;
      position: relative;
      display: inline-block;
      color: #3b2a21;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 60px;
      height: 3px;
      background: #d9a66d;
    }

    .order-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      position: relative;
    }

    .order-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e0e0e0;
      z-index: 1;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    .step-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e0e0e0;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .step.active .step-number {
      background: #5d4037;
    }

    .step-label {
      font-size: 14px;
      color: #888;
      transition: all 0.3s ease;
    }

    .step.active .step-label {
      color: #5d4037;
      font-weight: bold;
    }

    /* Product Selection */
    .product-selection {
      margin-bottom: 40px;
    }

    .product-item {
      display: flex;
      align-items: center;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    .product-item:hover {
      border-color: #d9a66d;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .product-image {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      margin-right: 20px;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-details {
      flex: 1;
    }

    .product-name {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 5px;
      color: #3b2a21;
    }

    .product-description {
      color: #7a5c44;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .product-price {
      font-size: 18px;
      font-weight: 700;
      color: #5d4037;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quantity-btn:hover {
      background: #e9e9e9;
    }

    .quantity-input {
      width: 50px;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 5px;
      font-size: 16px;
    }

    /* Delivery Section */
    .delivery-section {
      margin-bottom: 40px;
    }

    .delivery-options {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .delivery-option {
      flex: 1;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .delivery-option.active {
      border-color: #5d4037;
      background: #f9f5f0;
    }

    .delivery-option i {
      font-size: 24px;
      margin-bottom: 10px;
      color: #7a5c44;
    }

    .delivery-option.active i {
      color: #5d4037;
    }

    .postcode-check {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .postcode-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }

    .check-btn {
      padding: 12px 20px;
      background: #5d4037;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .check-btn:hover {
      background: #8d6e63;
    }

    .delivery-result {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      display: none;
    }

    .delivery-result.available {
      background: #e8f5e8;
      color: #2e7d32;
      display: block;
    }

    .delivery-result.unavailable {
      background: #ffebee;
      color: #c62828;
      display: block;
    }

    /* Customer Details */
    .customer-details {
      margin-bottom: 40px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #3b2a21;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      border-color: #5d4037;
      outline: none;
      box-shadow: 0 0 0 2px rgba(93, 64, 55, 0.2);
    }

    .form-row {
      display: flex;
      gap: 20px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Order Summary */
    .order-summary {
      background: #f9f5f0;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0e0e0;
    }

    .summary-total {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      font-size: 18px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 2px solid #d9a66d;
    }

    /* Buttons */
    .btn-group {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
    }

    .btn {
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 16px;
    }

    .btn-primary {
      background: #5d4037;
      color: #fff;
    }

    .btn-primary:hover {
      background: #8d6e63;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    /* Footer */
    .footer {
      background: #3b2a21;
      color: #e1dfdc;
      padding: 60px 20px 30px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .footer .footer-content {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 40px;
      max-width: 1100px;
      margin: 0 auto 40px;
    }

    .footer-column h3 {
      font-size: 20px;
      color: #f8f6f3;
      margin-bottom: 15px;
      position: relative;
    }

    .footer-column h3::after {
      content: "";
      width: 40px;
      height: 2px;
      background: #c89b6d;
      position: absolute;
      bottom: -6px;
      left: 0;
    }

    .footer-column p,
    .footer-column ul {
      font-size: 15px;
      line-height: 1.7;
      margin: 0;
    }

    .footer-column ul {
      list-style: none;
      padding: 0;
    }

    .footer-column ul li {
      margin-bottom: 10px;
    }

    .footer-column a {
      color: #e1dfdc;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-column a:hover {
      color: #c89b6d;
    }

    .social-icons a {
      font-size: 20px;
      margin-right: 12px;
      color: #e1dfdc;
      transition: color 0.3s;
    }

    .social-icons a:hover {
      color: #c89b6d;
    }

    .copyright {
      text-align: center;
      font-size: 14px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 20px;
      color: #aaa;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }

      .nav-menu {
        display: none;
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        background: white;
        flex-direction: column;
        padding: 20px;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        gap: 20px;
      }

      .nav-menu.active {
        display: flex;
      }

      .logo {
        font-size: 24px;
        text-align: left;
        padding-left: 10px;
      }

      .order-steps {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }

      .order-steps::before {
        display: none;
      }

      .step {
        flex-direction: row;
        gap: 15px;
      }

      .product-item {
        flex-direction: column;
        text-align: center;
      }

      .product-image {
        margin-right: 0;
        margin-bottom: 15px;
      }

      .delivery-options {
        flex-direction: column;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .btn-group {
        flex-direction: column;
      }
    }

    /* Postcode Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      visibility: hidden;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      visibility: visible;
      opacity: 1;
    }

    .postcode-modal {
      background: #fff;
      border-radius: 16px;
      padding: 25px;
      width: 90%;
      max-width: 400px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .postcode-modal {
      transform: translateY(0);
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }

    /* Postcode Checker Styles */
    .order-card .muted {
      color: #666;
      font-size: 14px;
      font-weight: 400;
      margin: 0 0 12px 0;
    }

    .order-card label {
      display: block;
      margin: 10px 0 6px 0;
      font-size: 14px;
      font-weight: 700;
      text-align: left;
    }

    .order-card input[type="text"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e3e3e8;
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
      font-weight: 400;
    }

    .order-card small {
      display: block;
      margin-top: 8px;
      color: #666;
      font-weight: 400;
      font-size: 12px;
      text-align: left;
    }

    .order-card button.check-btn {
      margin-top: 16px;
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-family: "Roboto", sans-serif;
      font-weight: 700;
      font-size: 14px;
      background: linear-gradient(135deg, #3b2a21, #2a1d16);
      color: #fff;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.3s ease;
    }

    .order-card button.check-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .order-card .result {
      margin-top: 14px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      text-align: left;
    }

    .order-card .ok {
      background: #e8fff2;
      color: #0b6b3a;
    }

    .order-card .no {
      background: #fff0f0;
      color: #8b1a1a;
    }

    .order-card {
      width: 100%;
      background: #fff;
      border-radius: 16px;
      padding: 25px;
      font-family: "Open Sans", sans-serif;
      text-align: center;
      display: flex;
      flex-direction: column;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid #e3e3e8;
    }

    .order-card h2 {
      margin: 0 0 20px 0;
      font-family: Roboto, sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: #5d4037;
    }

    .order-card button {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-family: "Roboto", sans-serif;
      font-weight: 700;
      font-size: 14px;
      background: #5d4037;
      color: #fff;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.3s ease;
    }

    .order-card button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Print Template (hidden on screen) */
    #printTemplate {
      display: none;
    }

    /* Print-specific styles */
    @media print {

      body,
      html {
        width: 100%;
        height: auto;
        margin: 0;
        padding: 0;
        background: white !important;
      }

      /* Hide everything except the print template */
      body * {
        display: none !important;
      }

      #printTemplate,
      #printTemplate * {
        display: block !important;
        visibility: visible !important;
      }

      #printTemplate {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: auto;
        margin: 0;
        padding: 20px;
        background: white;
        font-size: 18px;
      }

      .print-container {
        max-width: 400px;
        margin: 0 auto;
        text-align: center;
      }

      .print-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #eee;
      }

      .print-title {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .print-detail {
        margin: 20px 0;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
      }

      .print-label {
        font-weight: bold;
        color: #7f8c8d;
        margin-bottom: 5px;
      }

      .print-value {
        font-size: 20px;
        color: #2c3e50;
      }

      .print-orderid {
        font-size: 26px;
        font-weight: bold;
        color: #e74c3c;
        letter-spacing: 2px;
      }

      .print-footer {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 2px solid #eee;
        color: #7f8c8d;
        font-size: 16px;
      }
  </style>
</head>

<body>
  <!-- Announcement Bar -->
  <div class="announcement-bar">
    <i class="fas fa-bullhorn">
    </i>
    <span class="announcement-full">
    </span>
    <span class="announcement-short"> &nbsp; Pre-orders now open. Exclusive delivery within KL. Enjoy complimentary delivery with purchases of 3 bundles/18 pouches or more. &nbsp; </span>
  </div>
  <!-- Header -->
  <header>
    <div class="header-container">
      <!-- Mobile menu button -->
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars">
        </i>
      </button>
      <!-- Center: Logo -->
      <div class="logo"><a href="index.html" style="text-decoration:none; color:inherit;">11am Coffee</a></div>
      <!-- Mobile Actions (only show on mobile) -->
      <div class="mobile-actions">
        <button class="icon-btn" id="orderCheckBtnOpen">
          <i class="fas fa-clipboard-list">
          </i>
        </button>
        <button class="icon-btn" id="deliveryCheckBtn">
          <i class="fas fa-truck">
          </i>
        </button>
      </div>
      <!-- Navigation Menu -->
      <nav class="nav-menu" id="navMenu">
        <a href="index.html" class="nav-link">Home</a>
        <a href="index.html#shop" class="nav-link">Shop</a>
        <a href="order.html" class="nav-link">Order</a>
		<a href="index.html#feedback-form" class="nav-link">Feedback</a>  
        <a href="index.html#shop#about" class="nav-link">About Us</a>
        <button class="icon-btn" id="orderCheckBtnOpenNav">
          <i class="fas fa-clipboard-list">
          </i>
        </button>
        <button class="icon-btn" id="deliveryCheckBtnNav">
          <i class="fas fa-truck">
          </i>
        </button>
      </nav>
    </div>
  </header>
  <!-- Order Section -->
  <section class="order-section">
    <div class="container">
      <div class="order-container">
        <h2 class="section-title">Place Your Order</h2>
        <!-- Order Steps -->
        <div class="order-steps">
          <div class="step active">
            <div class="step-number">1</div>
            <div class="step-label">Select Products</div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-label">Delivery Info</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-label">Customer Details</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-label">Review & Pay</div>
          </div>
        </div>
        <!-- Product Selection -->
        <div class="product-selection">
          <h3>Select Your Coffee</h3>
          <div class="product-item">
            <div class="product-image">
              <img src="https://previews.dropbox.com/p/thumb/ACyLp1poWs_FB4_aDqG3YIR2fhU82pRucmRUkIiTsXQ1WOrSVd8E9C2le2IGIEprPyPhJ-frXxY5gXxDWLghPaMKt07h9SF1Y7ejG0mUBCgzPAyq-5w4Tc6qG69mU4bN1VXZRAgnsxm62hgpRxOhssL1Vr9A-Xno7HuhcyybvH4t8rRU8-59spuWiB9RmrZSlHb0YL4wDtsg5wyOYXCm1ioMynOygzh_s5n2iXLAxOmY_Me_nZJgZ5sJc1iTzA1yrZwBRsqi7NFihgZvhEw35Qbrg2gMBwPfVTe8QobcUavCOS6mEjHZjo9lTPU5P2l4WAJVuiDRJ1U2ThYTxBMPSAw8/p.jpeg?is_prewarmed=true" alt="Espresso">
            </div>
            <div class="product-details">
              <div class="product-name">Solo Pack</div>
              <div class="product-description"><p>6 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts</p></div>
              <div class="product-price">RM 36</div>
            </div>
            <div class="quantity-controls">
              <button class="quantity-btn minus" data-product="solopack">-</button>
              <input type="number" class="quantity-input" id="solopack-qty" value="0" min="0" max="10">
              <button class="quantity-btn plus" data-product="solopack">+</button>
            </div>
          </div>
          <div class="product-item">
            <div class="product-image">
              <img src="https://previews.dropbox.com/p/thumb/ACyLp1poWs_FB4_aDqG3YIR2fhU82pRucmRUkIiTsXQ1WOrSVd8E9C2le2IGIEprPyPhJ-frXxY5gXxDWLghPaMKt07h9SF1Y7ejG0mUBCgzPAyq-5w4Tc6qG69mU4bN1VXZRAgnsxm62hgpRxOhssL1Vr9A-Xno7HuhcyybvH4t8rRU8-59spuWiB9RmrZSlHb0YL4wDtsg5wyOYXCm1ioMynOygzh_s5n2iXLAxOmY_Me_nZJgZ5sJc1iTzA1yrZwBRsqi7NFihgZvhEw35Qbrg2gMBwPfVTe8QobcUavCOS6mEjHZjo9lTPU5P2l4WAJVuiDRJ1U2ThYTxBMPSAw8/p.jpeg?is_prewarmed=true" alt="Cappuccino">
            </div>
            <div class="product-details">
              <div class="product-name">Duo Pack</div>
              <div class="product-description">12 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts</div>
              <div class="product-price">RM 70</div>
            </div>
            <div class="quantity-controls">
              <button class="quantity-btn minus" data-product="duopack">-</button>
              <input type="number" class="quantity-input" id="duopack-qty" value="0" min="0" max="10">
              <button class="quantity-btn plus" data-product="duopack">+</button>
            </div>
          </div>
          <div class="product-item">
            <div class="product-image">
              <img src="https://previews.dropbox.com/p/thumb/ACyLp1poWs_FB4_aDqG3YIR2fhU82pRucmRUkIiTsXQ1WOrSVd8E9C2le2IGIEprPyPhJ-frXxY5gXxDWLghPaMKt07h9SF1Y7ejG0mUBCgzPAyq-5w4Tc6qG69mU4bN1VXZRAgnsxm62hgpRxOhssL1Vr9A-Xno7HuhcyybvH4t8rRU8-59spuWiB9RmrZSlHb0YL4wDtsg5wyOYXCm1ioMynOygzh_s5n2iXLAxOmY_Me_nZJgZ5sJc1iTzA1yrZwBRsqi7NFihgZvhEw35Qbrg2gMBwPfVTe8QobcUavCOS6mEjHZjo9lTPU5P2l4WAJVuiDRJ1U2ThYTxBMPSAw8/p.jpeg?is_prewarmed=true" alt="Cold Brew">
            </div>
            <div class="product-details">
              <div class="product-name">Family Pack</div>
              <div class="product-description">18 pouches | Arabica coffee beans <br>Taste notes: Dark chocolate, caramel, roasted walnuts</div>

              <div class="product-price">RM 105</div>
            </div>
            <div class="quantity-controls">
              <button class="quantity-btn minus" data-product="familypack">-</button>
              <input type="number" class="quantity-input" id="familypack-qty" value="0" min="0" max="10">
              <button class="quantity-btn plus" data-product="familypack">+</button>
            </div>
          </div>
        </div>
        <!-- Delivery Section -->
        <div class="delivery-section">
          <h3>Delivery Information</h3>
          <div class="delivery-options">
            <div class="delivery-option active" id="delivery-option">
              <i class="fas fa-truck">
              </i>
              <div>Delivery</div>
            </div>
            <div class="delivery-option" id="pickup-option">
              <i class="fas fa-store">
              </i>
              <div>Pickup</div>
            </div>
          </div>
          <div id="delivery-details">
            <p>Enter your postcode to check delivery availability:</p>
            <div class="postcode-check">
              <input type="text" class="postcode-input" id="postcodeorder" placeholder="Postcode will appear here after check" maxlength="5" readonly>
              <button class="check-btn" id="checkPostcode">Check</button>
            </div>
            <div class="delivery-result" id="delivery-result">
            </div>
            <!-- Delivery DateTime -->
            <div class="form-group">
              <label for="delivery-datetime" class="form-label">Select Delivery Date & Time</label>
              <input type="text" id="delivery-datetime" class="form-input" required>
            </div>
          </div>
          <div id="pickup-details" style="display: none;">
            <p>Pickup available at our store location:</p>
            <p>
              <strong>11am Coffee Shop</strong>
              <br>Currently Not available
            </p>
          </div>
        </div>
        <!-- Customer Details -->
        <div class="customer-details">
          <h3>Customer Details</h3>
          <form id="customer-form">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="name">Full Name</label>
                <input type="text" class="form-input" id="name" required>
                <small id="nameMsg" style="color:red;display:none;">⚠️ Please enter a valid Name</small>
              </div>
              <div class="form-group">
                <label class="form-label" for="phone">Phone Number</label>
                <input type="tel" class="form-input" id="phone" placeholder="+60..." required>
                <small id="phoneMsg" style="color:red;display:none;">⚠️ Please enter a valid Malaysian phone number</small>
              </div>
            </div>
			<div class="form-group">
			  <label class="form-label" for="email">Email Address</label>
			  <input 
				type="email" 
				class="form-input" 
				id="email" 
				placeholder="example@email.com" 
				required>
			  <small id="emailError" style="color:red; display:none;">⚠️ Please enter a valid email address</small>
			</div>
            <div class="form-group" id="address-field">
              <label class="form-label" for="address">Delivery Address</label>
              <textarea class="form-input" id="address" rows="3" required>
</textarea>
            </div>
            <!-- ✅ Promo Code -->
            <div class="form-group">
              <label class="form-label" for="promo">Promo Code (Optional)</label>
              <input type="text" class="form-input" id="promo" placeholder="Enter your promo code">
              <small id="promoMsg" style="color:green;display:none;">✅ Promo code applied!</small>
            </div>
            <div class="form-group">
              <label class="form-label" for="notes">Special Instructions (Optional)</label>
              <textarea class="form-input" id="notes" rows="2" placeholder="Any special requests or notes for your order">
</textarea>
            </div>
          </form>
        </div>
        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div id="summary-items">
            <div class="summary-item">
              <span>Items:</span>
              <span id="items-total">RM 0.00</span>
            </div>
            <div class="summary-item">
              <span>Delivery(Estimate Fee Only):</span>
              <span id="delivery-fee">RM 0.00</span>
            </div>
            <div class="summary-total">
              <span>Total:</span>
              <span id="order-total">RM 0.00</span>
            </div>
          </div>
        </div>
        <!-- Buttons -->
        <div class="btn-group">
          <button class="btn btn-secondary" id="back-btn">Back</button>
          <button class="btn btn-primary" id="continue-btn">Continue to Payment</button>
        </div>
        <!-- Error / status messages -->
        <div id="formMsg" style="margin-top:10px; font-weight:bold; text-align:center;">
        </div>
      </div>
    </div>
  </section>
  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>11am Coffee</h3>
          <p>Brewing joy in every cup — 11am Coffee, your daily ritual since 2025.</p>
        </div>
        <div class="footer-column">
          <h3>Contact Us</h3>
          <ul>
            <li>
              <i class="fas fa-phone">
              </i>
              <a href="tel:+60175115356">+60 17-511 5356</a>
            </li>
            <li>
              <i class="fab fa-whatsapp">
              </i>
              <a href="https://wa.me/60175115356" target="_blank">Message us on WhatsApp</a>
            </li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Follow Us</h3>
          <div class="social-icons">
            <a href="https://www.instagram.com/11amcoffee/">
              <i class="fab fa-instagram">
              </i>
            </a>
          </div>
        </div>
      </div>
      <div class="copyright">
        <p>&copy;2025 11 AM COFFEE 202503256298(CT0154839-U) • All rights reserved.</p>
      </div>
    </div>
  </footer>
  <!-- Postcode Checker Modal -->
  <div class="modal-overlay" id="postcodeModal">
    <div class="postcode-modal">
      <button class="modal-close" id="modalClose">
      </button>
      <div class="order-card">
        <div class="content">
          <h2>Check delivery by postcode</h2>
          <p class="muted">Enter your postcode and we'll tell you whether we deliver to your area (within 10 km of Pandan Perdana, KL 55330).</p>
          <label for="postcode">Postcode</label>
          <input id="postcode" type="text" inputmode="numeric" placeholder="e.g. 55330" aria-describedby="hint" />
          <small id="hint">Malaysian format: 5 digits.</small>
        </div>
        <button id="checkBtn" class="check-btn" style="padding:12px; font-size:15px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;">Check</button>
        <!-- Check result output -->
        <div id="output" class="result" aria-live="polite" style="display:none; margin-top:12px;">
        </div>
        <!-- ✅ Done button (hidden until result shown) -->
        <button id="doneBtn" style="display:none; margin-top:15px; padding:10px 18px; font-size:14px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;">Done</button>
      </div>
    </div>
  </div>
  <!-- ✅ Order Checker Modal -->
  <div class="modal-overlay" id="orderModal">
    <div class="postcode-modal">
      <button class="modal-close" id="orderModalClose">
      </button>
      <div class="order-card">
        <div class="content">
          <h2>Check your order</h2>
          <p class="muted">Enter your Order ID to track your order status.</p>
          <label for="orderId">Order ID</label>
          <input id="orderId" type="text" placeholder="e.g. ORD12345" aria-describedby="orderHint" />
          <small id="orderHint">Your Order ID is provided after checkout.</small>
        </div>
        <!-- ✅ Button inside modal to check -->
        <button id="checkOrderBtn" class="check-btn" style="padding:12px; font-size:15px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;"> Check Order </button>
        <!-- Result -->
        <div id="orderOutput" class="result" aria-live="polite" style="display:none; margin-top:12px;">
        </div>
        <!-- Done button -->
        <button id="orderDoneBtn" style="display:none; margin-top:15px; padding:10px 18px; font-size:14px; font-weight:600; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg, #3b2a21, #2a1d16); color:#fff; transition:0.3s;"> Done </button>
      </div>
    </div>
  </div>
  <!-- Print Template (hidden on screen) -->
  <div id="printTemplate">
    <div class="print-container">
      <div class="print-header">
        <h1 class="print-title">Order Confirmation</h1>
        <p>Thank you for your purchase!</p>
      </div>
      <div class="print-detail">
        <div class="print-label">Customer Name</div>
        <div class="print-value" id="printName">
        </div>
      </div>
      <div class="print-detail">
        <div class="print-label">Estimated Delivery</div>
        <div class="print-value" id="printDelivery">2-3 business days</div>
      </div>
      <div class="print-detail">
        <div class="print-label">Order ID</div>
        <div class="print-value" id="printOrderId" style="font-size:20px; font-weight:bold; color:#2196F3; letter-spacing:1px;">EL0000000000</div>
      </div>
      <div class="print-footer">
        <p>Please keep this receipt for your records</p>
        <p>Contact us if you have any questions</p>
      </div>
    </div>
  </div>
  <script type="module">
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navMenu = document.getElementById('navMenu');
    mobileMenuBtn.addEventListener('click', () => {
      navMenu.classList.toggle('active');
      const icon = mobileMenuBtn.querySelector('i');
      if (navMenu.classList.contains('active')) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
      } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
      }
    });
    document.addEventListener("DOMContentLoaded", function() {
      const quantityInputs = document.querySelectorAll(".quantity-input");
      const steps = document.querySelectorAll(".step");
      const checkPostcodeBtn = document.getElementById("checkPostcode");
      const postcodeInput = document.getElementById("postcodeorder");
      const deliveryResult = document.getElementById("delivery-result");
      const nameInput = document.getElementById("name");
      const phoneInput = document.getElementById("phone");
      const emailInput = document.getElementById("email");
      const addressInput = document.getElementById("address");
      // ---- STEP PROGRESS HANDLER ----
      function setActiveSteps(stepIndex) {
        steps.forEach((step, index) => {
          if (index <= stepIndex) {
            step.classList.add("active");
          } else {
            step.classList.remove("active");
          }
        });
      }
      // ---- PRODUCT SELECTION ----
      function updateStepProgress() {
        let hasProduct = false;
        quantityInputs.forEach(input => {
          if (parseInt(input.value) > 0) {
            hasProduct = true;
          }
        });
        if (hasProduct) {
          setActiveSteps(1); // Step 1 + Step 2
        } else {
          setActiveSteps(0); // Only Step 1
        }
      }
      quantityInputs.forEach(input => {
        input.addEventListener("input", updateStepProgress);
      });
      document.querySelectorAll(".quantity-btn").forEach(btn => {
        btn.addEventListener("click", function() {
          const input = this.parentElement.querySelector(".quantity-input");
          let currentValue = parseInt(input.value);
          if (this.classList.contains("plus") && currentValue < input.max) {
            input.value = currentValue;
          } else if (this.classList.contains("minus") && currentValue > input.min) {
            input.value = currentValue;
          }
          updateStepProgress();
          updateOrderSummary();
        });
      });
      // ---- CUSTOMER DETAILS CHECK ----
      function checkCustomerDetails() {
        if (nameInput.value.trim() !== "" && phoneInput.value.trim() !== "" && emailInput.value.trim() !== "" && addressInput.value.trim() !== "") {
          setActiveSteps(3); // Step 1 + 2 + 3 + 4
        }
      }
      [nameInput, phoneInput, emailInput, addressInput].forEach(input => {
        input.addEventListener("input", checkCustomerDetails);
      });
    });
    // Postcode Checker Functionality
    const deliveryCheckBtn = document.getElementById('deliveryCheckBtn');
    const deliveryCheckBtnNav = document.getElementById('deliveryCheckBtnNav'); // ✅ nav version
    const postcodeModal = document.getElementById('postcodeModal');
    const modalClose = document.getElementById('modalClose');
    const checkBtn = document.getElementById('checkBtn');
    const doneBtn = document.getElementById('doneBtn'); // ✅ added
    const postcodeInput = document.getElementById('postcode');
    const output = document.getElementById('output');
    // Open modal
    function openPostcodeModal() {
      postcodeModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    deliveryCheckBtn.addEventListener('click', openPostcodeModal);
    if (deliveryCheckBtnNav) {
      deliveryCheckBtnNav.addEventListener('click', openPostcodeModal);
    }
    // Reset when typing new postcode
    postcodeInput.addEventListener("input", function() {
      checkBtn.style.display = "inline-block"; // show Check
      doneBtn.style.display = "none"; // hide Done
      output.style.display = "none"; // hide old result
    });
    // Close modal
    function closePostcodeModal() {
      postcodeModal.classList.remove('active');
      document.body.style.overflow = '';
    }
    modalClose.addEventListener('click', closePostcodeModal);
    // Close when clicking outside modal
    postcodeModal.addEventListener('click', (e) => {
      if (e.target === postcodeModal) {
        closePostcodeModal();
      }
    });
    // Close with ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === "Escape" && postcodeModal.classList.contains('active')) {
        closePostcodeModal();
      }
    });
    // --- Postcode Checker Configuration ---
    const originLat = 3.1345;
    const originLng = 101.7432;
    const maxKm = 11; // allow up to 20 km
    function normalize(pc) {
      if (!pc) return '';
      return pc.replace(/\s+/g, '');
    }

    function isValidMalaysianPostcode(pc) {
      return /^\d{5}$/.test(pc);
    }

    function haversineDistance(lat1, lon1, lat2, lon2) {
      function toRad(x) {
        return x * Math.PI / 180
      }
      const R = 6371;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }
    async function geocodePostcode(postcode) {
      const url = `https://nominatim.openstreetmap.org/search?postalcode=${encodeURIComponent(postcode)}&country=Malaysia&format=json`;
      const res = await fetch(url, {
        headers: {
          'User-Agent': 'CoffeeDeliveryApp/1.0'
        }
      });
      const json = await res.json();
      if (json && json.length) {
        return {
          lat: parseFloat(json[0].lat),
          lng: parseFloat(json[0].lon)
        };
      }
      throw new Error('No results found');
    }
    // --- Delivery Rate Configuration ---
    const baseRates = {
      motorcycle: {
        base: 4,
        perKm: 1.5
      },
      car: {
        base: 7,
        perKm: 1.8
      },
      van: {
        base: 25,
        perKm: 3.5
      }
    };
    // Grab-style capped pricing for motorcycles
    function calculateDeliveryCost(distanceKm) {
      let rate = baseRates.motorcycle;
      let rawCost = rate.base + (rate.perKm * distanceKm);
      if (distanceKm <= 5) {
        return 7; // flat min RM7
      } else if (distanceKm <= 15) {
        return Math.min(rawCost, 19); // cap at RM19
      } else {
        return Math.round(rawCost); // beyond 15 km, round to whole RM
      }
    }
    checkBtn.addEventListener('click', async () => {
      const raw = postcodeInput.value;
      const pc = normalize(raw);
      output.style.display = 'block';
      if (!pc) {
        output.className = 'result no';
        output.textContent = 'Please enter a postcode.';
        return;
      }
      if (!isValidMalaysianPostcode(pc)) {
        output.className = 'result no';
        output.innerHTML = 'Invalid postcode format. Postcode should be exactly 5 digits.';
        return;
      }
      try {
        output.className = 'result';
        output.textContent = 'Checking postcode location and calculating delivery cost…';
        const {
          lat,
          lng
        } = await geocodePostcode(pc);
        const km = haversineDistance(originLat, originLng, lat, lng);
        const deliveryCost = calculateDeliveryCost(km);
        if (km < maxKm) {
          // ✅ Show Done button after result
          doneBtn.style.display = "inline-block";
          // ✅ Hide Check button
          checkBtn.style.display = "none";
          const postcodeOrderEl = document.getElementById("postcodeorder");
          if (postcodeOrderEl) {
            if (postcodeOrderEl.tagName === "INPUT") {
              postcodeOrderEl.value = pc; // store value for form submission
            } else {
              postcodeOrderEl.textContent = pc; // fallback if it's just a span/div
            }
          }
          const resultDivE1 = document.getElementById('delivery-result');
          resultDivE1.className = 'delivery-result available';
          resultDivE1.textContent = `Estimated delivery fee: RM ${Math.round(deliveryCost)}`;
          document.getElementById('delivery-fee').textContent = `RM ${Math.round(deliveryCost)}`;
          updateOrderSummary();
          output.className = 'result ok';
          output.innerHTML = `Good news — we deliver to 
         												
         														<strong>${pc}</strong> (≈${Math.round(km)} km away)!
         												
         														<br>
                                       Estimated delivery fee: 
         													
         															<strong>RM${Math.round(deliveryCost)}</strong>`;
        } else {
          doneBtn.style.display = "inline-block";
          // ✅ Hide Check button
          checkBtn.style.display = "none";
          output.className = 'result no';
          output.innerHTML = `Sorry, 
         													
         															<strong>${pc}</strong> is about ${Math.round(km)} km away, which is outside our ${maxKm} km delivery zone.`;
        }
      } catch (err) {
        output.className = 'result no';
        output.textContent = 'Could not find this postcode. Please check and try again.';
      }
    });
    postcodeInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') checkBtn.click();
    });

    // Quantity controls
    document.querySelectorAll('.quantity-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const product = this.getAttribute('data-product');
        const input = document.getElementById(`${product}-qty`);
        let value = parseInt(input.value);
        if (this.classList.contains('plus')) {
          value = Math.min(value + 1, parseInt(input.max));
        } else if (this.classList.contains('minus')) {
          value = Math.max(value - 1, parseInt(input.min));
        }
        input.value = value;
        updateOrderSummary();
      });
    });
    // Delivery/Pickup toggle
    const deliveryOption = document.getElementById('delivery-option');
    const pickupOption = document.getElementById('pickup-option');
    const deliveryDetails = document.getElementById('delivery-details');
    const pickupDetails = document.getElementById('pickup-details');
    const addressField = document.getElementById('address-field');
    deliveryOption.addEventListener('click', () => {
      deliveryOption.classList.add('active');
      pickupOption.classList.remove('active');
      deliveryDetails.style.display = 'block';
      pickupDetails.style.display = 'none';
      addressField.style.display = 'block';
      document.getElementById('address').required = true;
      updateOrderSummary();
    });
    pickupOption.addEventListener('click', () => {
      pickupOption.classList.add('active');
      deliveryOption.classList.remove('active');
      deliveryDetails.style.display = 'none';
      pickupDetails.style.display = 'block';
      addressField.style.display = 'none';
      document.getElementById('address').required = false;
      updateOrderSummary();
    });
    document.getElementById('checkPostcode').addEventListener('click', openPostcodeModal);
    if (deliveryCheckBtnNav) {
      deliveryCheckBtnNav.addEventListener('click', openPostcodeModal);
    }
    // Update order summary
    function updateOrderSummary() {
      const soloQty = parseInt(document.getElementById('solopack-qty').value) || 0;
      const duoQty = parseInt(document.getElementById('duopack-qty').value) || 0;
      const familyQty = parseInt(document.getElementById('familypack-qty').value) || 0;
      const soloPrice = 36;
      const duoPrice = 70;
      const familyPrice = 105;
      let itemsTotal = (soloQty * soloPrice) + (duoQty * duoPrice) + (familyQty * familyPrice);
      const deliveryEl = document.getElementById('delivery-fee');
      const resultDiv = document.getElementById('delivery-result');
      // ✅ Always extract original delivery fee from resultDiv
      let baseDeliveryFee = 0;
      const feeMatch = resultDiv.innerHTML.match(/RM\s*(\d+\.?\d*)/);
      if (feeMatch) {
        baseDeliveryFee = parseFloat(feeMatch[1]);
      }
      let deliveryFee = baseDeliveryFee;
      // ✅ Apply delivery discount if itemsTotal >= 103.90
      if (itemsTotal >= 103.90 && baseDeliveryFee > 0) {
        const discount = Math.min(8, baseDeliveryFee); // max RM8 off
        const discountedFee = baseDeliveryFee - discount;
        deliveryEl.textContent = `RM ${discountedFee.toFixed(2)} (discount applied, was RM ${baseDeliveryFee.toFixed(2)})`;
        deliveryFee = discountedFee;
      } else {
        // ❌ Restore original delivery fee from resultDiv
        deliveryEl.textContent = `RM ${baseDeliveryFee.toFixed(2)}`;
        deliveryFee = baseDeliveryFee;
      }
      // ✅ Apply promo code discount
      const promoInput = document.getElementById('promo');
      const promoMsg = document.getElementById('promoMsg');
      let promoDiscount = 0;
      if (promoInput && promoInput.value.trim().toUpperCase() === "11AMFIRSTUSER") {
        promoDiscount = 5; // RM5 discount
        promoMsg.style.display = "block";
        promoMsg.style.color = "green";
        promoMsg.textContent = "✅ Promo code applied: -RM5";
      } else if (promoInput && promoInput.value.trim() !== "") {
        promoMsg.style.display = "block";
        promoMsg.style.color = "red";
        promoMsg.textContent = "❌ Invalid promo code";
      } else {
        promoMsg.style.display = "none";
      }
      // ✅ Final totals
      const grandTotal = itemsTotal + deliveryFee - promoDiscount;
      document.getElementById('items-total').textContent = `RM ${itemsTotal.toFixed(2)}`;
      document.getElementById('order-total').textContent = `RM ${grandTotal.toFixed(2)}`;
    }
    // Initialize order summary
    updateOrderSummary();
    // Back button
    document.getElementById('back-btn').addEventListener('click', function() {
      window.history.back();
    });
	
	// ✅ Handle Continue Button
document.getElementById("continue-btn").addEventListener("click", async function() {
  const msgEl = document.getElementById("formMsg");
  msgEl.style.color = "red"; // default red for errors

  // Collect selected products
  let selected = [];
  const products = ["solopack", "duopack", "familypack"];
  products.forEach(p => {
    const qty = parseInt(document.getElementById(`${p}-qty`).value) || 0;
    if (qty > 0) {
      selected.push({ product: p, qty: qty });
    }
  });
  if (selected.length === 0) {
    msgEl.textContent = "⚠️ Please select at least one product.";
    return;
  }

  // Delivery postcode check
  const postcode = document.getElementById("postcodeorder").value.trim();
  if (!postcode) {
    msgEl.textContent = "⚠️ Please check your delivery postcode before continuing.";
    return;
  }

  // Customer details
  const custdeliverytime = document.getElementById("delivery-datetime").value.trim();
  const custName = document.getElementById("name").value.trim();
  const custPhone = document.getElementById("phone").value.trim();
  const custEmail = document.getElementById("email").value.trim();
  const custAddress = document.getElementById("address").value.trim();

  if (!custName || !custPhone || !custEmail || !custAddress) {
    msgEl.textContent = "⚠️ Please fill in all customer details.";
    return;
  }
  if (!custdeliverytime) {
    msgEl.textContent = "⚠️ Please Select Delivery DateTime";
    return;
  }

  // Phone validation
  const phoneRegex = /^(?:\+60\d{9,10}|0\d{8,9})$/;
  if (!phoneRegex.test(custPhone)) {
    msgEl.textContent = "⚠️ Please enter a valid phone number (e.g., +60123456789 or 0143810530).";
    return;
  }

  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(custEmail)) {
    msgEl.textContent = "⚠️ Please enter a valid email (e.g., example@email.com).";
    return;
  }

  // Totals
  const orderTotal = document.getElementById("items-total").textContent;
  const deliveryFee = document.getElementById("delivery-fee").textContent;
  const grandTotal = document.getElementById("order-total").textContent;

  // Payload
  const payload = {
    CustName: custName,
    Phone: custPhone,
    Email: custEmail,
    Address: custAddress,
    Orders: selected,
    OrderPrice: orderTotal,
    DeliveryFee: deliveryFee,
    GrandTotal: grandTotal,
    DateTime: new Date().toLocaleString("en-GB", { timeZone: "Asia/Kuala_Lumpur" }),
    Status: "New",
    DeliveryTime: custdeliverytime
  };

  console.log("Final Payload 👉", payload);

  // Status: loading
  msgEl.textContent = "⏳ Placing your order, please wait...";
  msgEl.style.color = "blue";
  const btn = document.getElementById("continue-btn");
  btn.disabled = true;
  btn.textContent = "Submitting Order...";

  try {
    // 🔗 Call Cloudflare Worker instead of Firebase
    const response = await fetch("https://gentle-grass-be7d.11amcoffeebackoffice.workers.dev/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    const result = await response.json();
    console.log("Worker Response 👉", result);

    if (result.success) {
      const newOrderId = result.orderId;

      document.getElementById("printOrderId").textContent = newOrderId;
      document.getElementById("printName").textContent = custName;

      sessionStorage.setItem("selectedOrders", JSON.stringify(payload));

      setTimeout(() => {
        window.location.replace(
          `payment.html?orderId=${newOrderId}&name=${encodeURIComponent(custName)}&deliveryfee=${encodeURIComponent(deliveryFee)}&ordertotal=${encodeURIComponent(orderTotal)}&grandtotal=${encodeURIComponent(grandTotal)}&address=${encodeURIComponent(custAddress)}`
        );
      }, 2000);
    } else {
      btn.disabled = false;
      btn.textContent = "Continue to Payment";
      msgEl.textContent = "⚠️ Failed to save order: " + (result.error || "Unknown error");
    }
  } catch (err) {
    btn.disabled = false;
    btn.textContent = "Continue to Payment";
    console.error("❌ Error:", err);
    msgEl.textContent = "⚠️ Failed to save order, please try again.";
  }
});
	
    // Close modal with Done button
    document.getElementById("doneBtn").addEventListener("click", function() {
      postcodeModal.classList.remove('active');
      document.body.style.overflow = '';
    });
    //Phone Verification
    const phoneInput = document.getElementById("phone");
    const phoneMsg = document.getElementById("phoneMsg");
    // Auto-add +60 if missing
    phoneInput.addEventListener("focus", () => {
      if (!phoneInput.value.startsWith("+60")) {
        phoneInput.value = "+60";
      }
    });
    // Validate on blur or input
    phoneInput.addEventListener("input", () => {
      // 🔥 Remove all spaces automatically
      phoneInput.value = phoneInput.value.replace(/\s+/g, "");
      validatePhone();
    });

    function normalizePhone(input) {
      let phone = input.replace(/\s+/g, ""); // remove spaces
      // If starts with 0 (like 014...), replace leading 0 with +60
      if (/^0\d{8,9}$/.test(phone)) {
        phone = "+60" + phone.substring(1);
      }
      // If already starts with +60, leave it
      return phone;
    }

    function validatePhone() {
      phoneInput.value = normalizePhone(phoneInput.value);
      const phone = phoneInput.value.trim();
      const regex = /^\+60\d{9,10}$/;
      if (regex.test(phone)) {
        phoneMsg.style.display = "none";
        phoneInput.style.borderColor = "green";
        return true;
      } else {
        phoneMsg.style.display = "block";
        phoneInput.style.borderColor = "red";
        return false;
      }
    }
    //Name Verification
    const nameInput = document.getElementById("name");
    const nameMsg = document.getElementById("nameMsg");
    // Validate on blur or input
    nameInput.addEventListener("input", () => {
      validateName();
    });

    function validateName() {
      const name = nameInput.value.trim();
      // Regex: +60, followed by 9–10 digits
      const regex = /^\+60\d{9,10}$/;
      if (name) {
        nameMsg.style.display = "none"; // ✅ valid
        nameInput.style.borderColor = "green";
        return true;
      } else {
        nameMsg.style.display = "block"; // ❌ invalid
        nameInput.style.borderColor = "red";
        return false;
      }
    }

    function setupDateTimePicker(selector) {
      flatpickr(selector, {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        minDate: "today",
        time_24hr: true,
        minuteIncrement: 30, // ✅ Only 30-minute slots
        minTime: "12:00", // ✅ Earliest time = 12:00 PM
        maxTime: "21:00", // ✅ Latest time = 9:00 PM
        disable: [
          function(date) {
            // Disable Monday–Thursday
            return (date.getDay() >= 1 && date.getDay() <= 4);
          }
        ]
      });
    }
    setupDateTimePicker("#delivery-datetime");
    setupDateTimePicker("#pickup-datetime");
    const promoInput = document.getElementById('promo');
    if (promoInput) {
      promoInput.addEventListener('input', () => {
        // Auto-uppercase the input
        promoInput.value = promoInput.value.toUpperCase();
        // Recalculate totals whenever promo changes
        updateOrderSummary();
      });
    }
	
	const emailInput = document.getElementById("email");
	const emailError = document.getElementById("emailError");

	  emailInput.addEventListener("input", function () {
		const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

		if (emailInput.value.trim() === "") {
		  emailError.style.display = "none"; // hide if empty
		} else if (!emailRegex.test(emailInput.value)) {
		  emailError.style.display = "inline";
		} else {
		  emailError.style.display = "none"; // valid email
		}
	  });
	

  </script>
  <script src="Modal/modalscript.js"></script>
</body>
</html>